(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[241],{32083:function(e,l,s){(window.__NEXT_P=window.__NEXT_P||[]).push(["/dataprocess",function(){return s(40815)}])},40815:function(e,l,s){"use strict";s.r(l),s.d(l,{default:function(){return e8}});var t,n,i=s(85893),a=s(76212);let r=function(){let e=arguments.length>0&&void 0!==arguments[0]&&arguments[0],l=arguments.length>1?arguments[1]:void 0;return(0,a.HT)("/api/file-types",{enabled_only:e},l)},d=(e,l)=>(0,a.a4)("/api/file-types",e,l),o=(e,l,s)=>(0,a.uO)("/api/file-types/".concat(e),l,s),c=function(){let e=arguments.length>0&&void 0!==arguments[0]&&arguments[0],l=arguments.length>1?arguments[1]:void 0;return(0,a.HT)("/api/scan-configs",{enabled_only:e},l)},x=(e,l)=>(0,a.a4)("/api/scan-configs/ftp",e,l),u=(e,l,s)=>(0,a.uO)("/api/scan-configs/".concat(e),l,s),h=(e,l)=>(0,a.yY)("/api/scan-configs/".concat(e),void 0,l),p=e=>(0,a.a4)("/api/scan/async",void 0,e),m=e=>(0,a.a4)("/api/scan/test",void 0,e),f=(e,l)=>(0,a.a4)("/api/test-ftp",e,l),j=(e,l)=>(0,a.HT)("/api/tasks/".concat(e),void 0,l),g=(e,l,s)=>(0,a.uO)("/api/tasks/".concat(e),l,s);(t=n||(n={})).PENDING="pending",t.PROCESSING="processing",t.COMPLETED="completed",t.FAILED="failed",t.SKIPPED="skipped";let y=(e,l)=>(0,a.a4)("/api/pipeline/reprocess",e,l),v=e=>(0,a.HT)("/api/processors/status",void 0,e),Z=(e,l)=>(0,a.a4)("/api/processors/control",e,l),b=e=>(0,a.HT)("/api/knowledge-mappings",void 0,e),w=(e,l)=>(0,a.a4)("/api/knowledge-mappings",e,l),k=(e,l)=>(0,a.a4)("/api/knowledge-mappings/delete",e,l),P=(e,l)=>(0,a.a4)("/api/file-processing/list",e,l),C=e=>(0,a.HT)("/api/file-processing/statistics/all",void 0,e),_=(e,l)=>(0,a.a4)("/api/file-processing/batch/delete",e,l),S=e=>(0,a.yY)("/api/file-processing/clear",void 0,e);var z=s(26911),T=s(13520),I=s(51046),F=s(33160),R=s(42952),B=s(86548),L=s(48689),V=s(2830),N=s(24019),E=s(63437),D=s(30159),O=s(74842),U=s(98165),A=s(68795),M=s(26024),q=s(14313),H=s(24969),X=s(34041),K=s(45030),G=s(85576),W=s(47221),Q=s(99859),J=s(45360),Y=s(40411),$=s(66309),ee=s(84567),el=s(42075),es=s(83062),et=s(14726),en=s(72269),ei=s(4393),ea=s(71230),er=s(15746),ed=s(25278),eo=s(39773),ec=s(13457),ex=s(67294);let{Option:eu}=X.default,{Title:eh,Text:ep}=K.default,{confirm:em}=G.default,{Panel:ef}=W.default,ej=[{label:"秒",value:"seconds",multiplier:1},{label:"分钟",value:"minutes",multiplier:60},{label:"小时",value:"hours",multiplier:3600}];var eg=()=>{var e,l,s,t,n,K,eg,ey,ev,eZ,eb,ew,ek,eP,eC,e_,eS;let[ez,eT]=(0,ex.useState)([]),[eI]=Q.default.useForm(),[eF]=Q.default.useForm(),[eR,eB]=(0,ex.useState)(null),[eL,eV]=(0,ex.useState)([]),[eN,eE]=(0,ex.useState)(null),[eD,eO]=(0,ex.useState)(!1),[eU,eA]=(0,ex.useState)(24),[eM,eq]=(0,ex.useState)(["1","2","3"]),[eH,eX]=(0,ex.useState)(!1),[eK,eG]=(0,ex.useState)(!1),[eW]=Q.default.useForm(),[eQ]=Q.default.useForm(),[eJ,eY]=(0,ex.useState)(null),[e$,e0]=(0,ex.useState)("seconds"),[e1,e4]=(0,ex.useState)(10),[e6,e2]=(0,ex.useState)(!1),[e8,e5]=(0,ex.useState)(!1),[e3,e9]=(0,ex.useState)(1e3),[e7,le]=(0,ex.useState)(null),[ll,ls]=(0,ex.useState)(!1),[lt,ln]=(0,ex.useState)([]),[li,la]=(0,ex.useState)(null),[lr,ld]=(0,ex.useState)(!1),[lo,lc]=(0,ex.useState)(!1),[lx,lu]=(0,ex.useState)(!1),[lh,lp]=(0,ex.useState)(!1),[lm,lf]=(0,ex.useState)(!1),lj=(0,ex.useCallback)(async()=>{let[e,l]=await (0,a.Vx)(v());!e&&l&&la(l)},[]),[lg,ly]=(0,ex.useState)({enabled:!1,language:"auto",batchSize:10}),[lv,lZ]=(0,ex.useState)({status:"",source_type:"",file_type:"",nameSearch:""}),[lb,lw]=(0,ex.useState)({field:"created_at",order:"desc"}),[lk,lP]=(0,ex.useState)([]),[lC,l_]=(0,ex.useState)([]),[lS,lz]=(0,ex.useState)(!1),[lT]=Q.default.useForm(),[lI,lF]=(0,ex.useState)([]),[lR,lB]=(0,ex.useState)([]),[lL]=Q.default.useForm(),lV=(0,ex.useCallback)(async()=>{try{let[e,l]=await (0,a.Vx)(r(!1));!e&&l&&(lP(l),l_(l.map(e=>({...e}))))}catch(l){console.error("加载文件类型配置失败:",l);let e=[{extension:".wav",enabled:!0,description:"WAV 音频文件"},{extension:".mp3",enabled:!0,description:"MP3 音频文件"},{extension:".txt",enabled:!0,description:"TXT 文本文件"},{extension:".pdf",enabled:!0,description:"PDF 文档文件"}];lP(e),l_(e.map(e=>({...e})))}},[]),lN=async e=>{try{eX(!0);let l=e.fileTypes||[],s={".wav":{description:"WAV 音频文件",category:"audio"},".mp3":{description:"MP3 音频文件",category:"audio"},".mp4":{description:"MP4 视频文件",category:"video"},".flac":{description:"FLAC 音频文件",category:"audio"},".aac":{description:"AAC 音频文件",category:"audio"},".txt":{description:"TXT 文本文件",category:"text"},".doc":{description:"DOC 文档文件",category:"document"},".docx":{description:"DOCX 文档文件",category:"document"},".pdf":{description:"PDF 文档文件",category:"document"},".xlsx":{description:"XLSX 表格文件",category:"document"},".ppt":{description:"PPT 演示文稿",category:"document"},".pptx":{description:"PPTX 演示文稿",category:"document"},".jpg":{description:"JPG 图片文件",category:"image"},".png":{description:"PNG 图片文件",category:"image"}},t=[];for(let e of lC){let s=l.includes(e.extension);if(e.enabled!==s){let l={extension:e.extension,enabled:s,description:e.description};t.push((0,a.Vx)(o(e.extension,l)))}}let n=lC.map(e=>e.extension),i=l.filter(e=>!n.includes(e));for(let e of i){let l=s[e],n={extension:e,enabled:!0,description:(null==l?void 0:l.description)||"".concat(e," 文件"),category:null==l?void 0:l.category};t.push((0,a.Vx)(d(n)))}if(t.length>0){let e=await Promise.all(t),l=e.filter(e=>{let[l]=e;return l});0===l.length?(J.ZP.success("文件类型配置已保存 (".concat(t.length,"个更新)")),lz(!1),await lV(),lA()):(J.ZP.error("保存失败: ".concat(l.length,"个操作出错")),console.error("保存文件类型配置时出错:",l))}else J.ZP.info("没有检测到配置变化"),lz(!1)}catch(e){console.error("保存文件类型配置失败:",e),J.ZP.error("保存文件类型配置失败")}finally{eX(!1)}},lE=async function(e){let l=arguments.length>1&&void 0!==arguments[1]&&arguments[1];try{let s,t;eX(!0),l?(s={name:e.name,host:e.ftpHost,username:e.ftpUser,password:e.ftpPassword,port:e.ftpPort||21,remote_dir:e.scanPath||"/"},t=e.name||"新配置"):(s={name:e.name,host:e.config.host,username:e.config.username,password:e.config.password,port:e.config.port||21,remote_dir:e.config.remote_dir||"/"},t=e.name),console.log("测试FTP连接配置:",s);let[n,r]=await (0,a.Vx)(f(s));!n&&r?r.error?(G.default.info({title:"FTP连接测试结果 - ".concat(t),width:700,content:(0,i.jsxs)("div",{children:[(0,i.jsxs)("div",{style:{marginBottom:16},children:[(0,i.jsx)(ep,{strong:!0,children:"连接信息:"}),(0,i.jsxs)("div",{style:{marginLeft:16,marginTop:8},children:[(0,i.jsxs)("div",{children:["主机: ",s.host,":",s.port]}),(0,i.jsxs)("div",{children:["用户: ",s.username]}),(0,i.jsx)("div",{style:{color:"#ff4d4f"},children:"状态: 连接失败"})]})]}),(0,i.jsxs)("div",{children:[(0,i.jsx)(ep,{strong:!0,children:"错误信息:"}),(0,i.jsx)("div",{style:{marginLeft:16,marginTop:8,color:"#ff4d4f"},children:r.message||r.error||"连接失败"})]})]})}),J.ZP.error("FTP连接测试失败: ".concat(r.message||r.error))):(G.default.info({title:"FTP连接测试结果 - ".concat(t),width:700,content:(0,i.jsxs)("div",{children:[(0,i.jsxs)("div",{style:{marginBottom:16},children:[(0,i.jsx)(ep,{strong:!0,children:"连接信息:"}),(0,i.jsxs)("div",{style:{marginLeft:16,marginTop:8},children:[(0,i.jsxs)("div",{children:["主机: ",r.host,":",r.port]}),(0,i.jsxs)("div",{children:["用户: ",r.username]}),(0,i.jsx)("div",{style:{color:"#52c41a"},children:"状态: 连接成功"})]})]}),r.remote_dir_status&&(0,i.jsxs)("div",{style:{marginBottom:16},children:[(0,i.jsx)(ep,{strong:!0,children:"远程目录状态:"}),(0,i.jsx)("div",{style:{marginLeft:16,marginTop:8,color:r.remote_dir_status.includes("成功")?"#52c41a":"#ff4d4f"},children:r.remote_dir_status})]}),Array.isArray(r.root_files)&&r.root_files.length>0&&(0,i.jsxs)("div",{children:[(0,i.jsx)(ep,{strong:!0,children:"根目录文件 (前20个):"}),(0,i.jsx)("div",{style:{marginLeft:16,marginTop:8,maxHeight:200,overflow:"auto",backgroundColor:"#f5f5f5",padding:8,borderRadius:4,fontSize:12,fontFamily:"monospace"},children:r.root_files.map((e,l)=>(0,i.jsx)("div",{children:e},l))})]}),"string"==typeof r.root_files&&(0,i.jsxs)("div",{children:[(0,i.jsx)(ep,{strong:!0,children:"文件列表错误:"}),(0,i.jsx)("div",{style:{marginLeft:16,marginTop:8,color:"#ff4d4f"},children:r.root_files})]})]})}),J.ZP.success("FTP连接测试成功")):(G.default.info({title:"FTP连接测试结果 - ".concat(t),width:700,content:(0,i.jsxs)("div",{children:[(0,i.jsxs)("div",{style:{marginBottom:16},children:[(0,i.jsx)(ep,{strong:!0,children:"连接信息:"}),(0,i.jsxs)("div",{style:{marginLeft:16,marginTop:8},children:[(0,i.jsxs)("div",{children:["主机: ",s.host,":",s.port]}),(0,i.jsxs)("div",{children:["用户: ",s.username]}),(0,i.jsx)("div",{style:{color:"#ff4d4f"},children:"状态: 连接失败"})]})]}),(0,i.jsxs)("div",{children:[(0,i.jsx)(ep,{strong:!0,children:"错误信息:"}),(0,i.jsx)("div",{style:{marginLeft:16,marginTop:8,color:"#ff4d4f"},children:(null==n?void 0:n.message)||"连接测试失败"})]})]})}),J.ZP.error("FTP连接测试失败"))}catch(e){console.error("测试FTP连接时出错:",e),G.default.info({title:"FTP连接测试结果 - ".concat(configName),width:700,content:(0,i.jsxs)("div",{children:[(0,i.jsxs)("div",{style:{marginBottom:16},children:[(0,i.jsx)(ep,{strong:!0,children:"连接信息:"}),(0,i.jsxs)("div",{style:{marginLeft:16,marginTop:8},children:[(0,i.jsxs)("div",{children:["主机: ",testConfig.host,":",testConfig.port]}),(0,i.jsxs)("div",{children:["用户: ",testConfig.username]}),(0,i.jsx)("div",{style:{color:"#ff4d4f"},children:"状态: 连接异常"})]})]}),(0,i.jsxs)("div",{children:[(0,i.jsx)(ep,{strong:!0,children:"错误信息:"}),(0,i.jsx)("div",{style:{marginLeft:16,marginTop:8,color:"#ff4d4f"},children:"连接测试出现异常"})]})]})}),J.ZP.error("测试连接时出现异常")}finally{eX(!1)}},lD=(0,ex.useCallback)(async()=>{let[e,l]=await (0,a.Vx)((0,a.vD)("chat_knowledge"));!e&&l&&(lF(l),console.log(lI))},[]),lO=(0,ex.useCallback)(async()=>{let[e,l]=await (0,a.Vx)(b());!e&&l&&lB(l)},[]),lU=(0,ex.useCallback)(async()=>{ls(!0);try{let[e,l]=await (0,a.Vx)(P({page:1,page_size:100,source_type:"ftp"})),[s,t]=await (0,a.Vx)(P({page:1,page_size:100,source_type:"stt"})),n=[];!e&&l&&n.push(...l.items),!s&&t&&n.push(...t.items),eV(n)}catch(e){console.error("加载文件列表失败:",e)}finally{ls(!1)}},[]),lA=(0,ex.useCallback)(async()=>{let[e,l]=await (0,a.Vx)(c());!e&&l&&eT(l)},[]),lM=(0,ex.useCallback)(async()=>{let[e,l]=await (0,a.Vx)(C());!e&&l&&eB(l)},[]),lq=(0,ex.useCallback)(async()=>{let[e,l]=await (0,a.Vx)(j("file_scan"));!e&&l?eY(l):eY(null)},[]),lH=async e=>{try{ld(!0);let[l,s]=await (0,a.Vx)(Z({action:e,processor_name:"audio_to_text"}));!l&&s&&(J.ZP.success("语音转换处理器已".concat("start"===e?"启动":"停止")),await lj())}catch(l){J.ZP.error("".concat("start"===e?"启动":"停止","语音转换处理器失败"))}finally{ld(!1)}},lX=async e=>{try{lc(!0);let[l,s]=await (0,a.Vx)(Z({action:e,processor_name:"knowledge_processor"}));!l&&s&&(J.ZP.success("知识库处理器已".concat("start"===e?"启动":"停止")),await lj())}catch(l){J.ZP.error("".concat("start"===e?"启动":"停止","知识库处理器失败"))}finally{lc(!1)}};(0,ex.useEffect)(()=>{lD(),lO(),lA(),lM(),lU(),lq(),lj(),lV()},[lD,lO,lA,lM,lU,lq,lj,lV]),(0,ex.useEffect)(()=>{let e;return lm&&(e=setInterval(()=>{lU(),lM(),lj()},e3)),()=>{e&&clearInterval(e)}},[lm,e3,lU,lM]),(0,ex.useEffect)(()=>{if(e6&&eJ){eF.resetFields();let e=eJ.config.interval_seconds||10,l=eJ.running||!1;eF.setFieldsValue({enabled:l,timeValue:e,timeUnit:"seconds"}),e0("seconds"),e4(e)}},[e6,eJ,eF]);let lK=async e=>{try{eX(!0);let l=ej.find(l=>l.value===e.timeUnit),s=e.timeValue*((null==l?void 0:l.multiplier)||1),t={enabled:e.enabled,interval_seconds:s},[n]=await (0,a.Vx)(g("file_scan",t));n||(J.ZP.success("定时任务配置更新成功"),e2(!1),await lq())}catch(e){console.error("更新定时任务配置失败:",e),J.ZP.error("更新定时任务配置失败")}finally{eX(!1)}},lG=async e=>{try{eX(!0);let l={name:e.name||(eK?"FTP-".concat(Date.now()):(null==eN?void 0:eN.name)||"FTP-".concat(Date.now())),host:e.ftpHost,username:e.ftpUser,password:e.ftpPassword,port:e.ftpPort||21,remote_dir:e.scanPath||"/",enabled:void 0===e.enabled||e.enabled},[s]=await (0,a.Vx)(x(l));s||(J.ZP.success("FTP配置".concat(eK?"添加":"保存","成功")),eE(null),eG(!1),lA())}catch(e){console.error("".concat(eK?"添加":"保存","FTP配置失败:"),e),J.ZP.error("".concat(eK?"添加":"保存","FTP配置失败"))}finally{eX(!1)}},lW=e=>{eG(!1),eE(e),setTimeout(()=>{var l,s,t,n,i,a;eQ.setFieldsValue({name:e.name,ftpHost:null===(l=e.config)||void 0===l?void 0:l.host,ftpPort:(null===(s=e.config)||void 0===s?void 0:s.port)||21,scanPath:(null===(t=e.config)||void 0===t?void 0:t.remote_dir)||"/",ftpUser:null===(n=e.config)||void 0===n?void 0:n.username,ftpPassword:null===(i=e.config)||void 0===i?void 0:i.password,fileTypes:(null===(a=e.config)||void 0===a?void 0:a.file_types)||[".wav",".mp3",".txt",".pdf"],enabled:e.enabled})},100)},lQ=async e=>{try{eX(!0);let l=(null==eJ?void 0:eJ.config.interval_seconds)||10,[s]=await (0,a.Vx)(g("file_scan",{enabled:e,interval_seconds:l}));s||(J.ZP.success("定时扫描已".concat(e?"启用":"停用")),await lq())}catch(e){console.error("切换定时任务状态失败:",e)}finally{eX(!1)}},lJ=async()=>{try{eX(!0);let[e,l]=await (0,a.Vx)(m());if(!e&&l){let{test_results:e}=l,s=0,t=0;e.forEach(e=>{"success"===e.status?s++:t++}),0===t?J.ZP.success("所有配置测试通过 (".concat(s,"个)")):J.ZP.warning("".concat(s,"个配置正常，").concat(t,"个配置异常")),G.default.info({title:"连接测试结果",width:600,content:(0,i.jsx)("div",{children:e.map((e,l)=>(0,i.jsxs)("div",{style:{marginBottom:8},children:[(0,i.jsxs)($.Z,{color:"success"===e.status?"green":"red",children:[e.name," (",e.type,")"]}),(0,i.jsx)("span",{style:{marginLeft:8},children:e.message})]},l))})})}}catch(e){console.error("测试连接失败:",e)}finally{eX(!1)}},lY=async()=>{let e=ez.filter(e=>e.enabled);if(0===e.length){J.ZP.warning("请先启用至少一个扫描配置才能开始扫描");return}try{eO(!0);let[e]=await (0,a.Vx)(p());if(!e){J.ZP.success("扫描任务已启动");let e=setInterval(()=>{lM(),lU()},2e3);setTimeout(()=>{clearInterval(e),eO(!1),J.ZP.info("扫描任务执行完成")},1e4)}}catch(e){console.error("启动扫描失败:",e),eO(!1)}},l$=async e=>{try{let[l]=await (0,a.Vx)(u(e.name,{enabled:!e.enabled}));l||(J.ZP.success("配置 ".concat(e.name," 已").concat(e.enabled?"停用":"启用")),lA())}catch(e){console.error("更新扫描配置失败:",e)}},l0=e=>{em({title:"确认删除",content:'确定要删除扫描配置 "'.concat(e.name,'" 吗？'),onOk:async()=>{try{let[l]=await (0,a.Vx)(h(e.name));l||(J.ZP.success("扫描配置删除成功"),lA())}catch(e){console.error("删除扫描配置失败:",e)}}})},l1=e=>{G.default.confirm({title:"确认删除",content:"确定要删除 ".concat(e.length," 个文件记录吗？此操作不可恢复。"),onOk:async()=>{try{ls(!0);let[l,s]=await (0,a.Vx)(_({file_ids:e}));!l&&s&&(J.ZP.success("成功删除 ".concat(s," 个文件记录")),ln([]),await lU())}catch(e){console.error("删除文件记录失败:",e),J.ZP.error("删除文件记录失败")}finally{ls(!1)}}})},l4=async e=>{let l=e||lt;if(0===l.length){J.ZP.warning("请先选择要重新处理的文件");return}try{ls(!0);let[s,t]=await (0,a.Vx)(y({file_ids:l}));if(!s&&t){let{success_count:l,failed_files:s,total_count:n}=t;0===s.length?J.ZP.success("已将 ".concat(l," 个文件重新加入处理队列")):(J.ZP.warning("成功处理 ".concat(l," 个文件，").concat(s.length," 个文件处理失败")),s.length>0&&console.warn("重新处理失败的文件:",s)),e||ln([]),await lU()}}catch(e){console.error("重新处理失败:",e),J.ZP.error("重新处理失败")}finally{ls(!1)}},l6=e=>{J.ZP.info("开始下载 ".concat(e.file_name))},l2=e=>{"success"===e.status&&l7(e)?(window.open("/construct/knowledge","_blank"),J.ZP.success('已打开知识库管理页面，可查看文件 "'.concat(e.file_name,'" 的知识库内容'))):l7(e)?J.ZP.warning("文件处理完成后才能跳转到知识库"):J.ZP.warning("只有文本文件才能跳转到知识库")},l8=()=>{let e=[...eL];return lv.status&&(e=e.filter(e=>e.status===lv.status)),lv.source_type&&(e=e.filter(e=>e.source_type===lv.source_type)),lv.file_type&&(e=e.filter(e=>{var l;return null===(l=e.file_type)||void 0===l?void 0:l.toLowerCase().includes(lv.file_type.toLowerCase())})),lv.nameSearch&&(e=e.filter(e=>e.file_name.toLowerCase().includes(lv.nameSearch.toLowerCase()))),e.sort((e,l)=>{let s,t;switch(lb.field){case"file_name":s=e.file_name.toLowerCase(),t=l.file_name.toLowerCase();break;case"size":s=e.size||0,t=l.size||0;break;case"status":s=e.status,t=l.status;break;case"source_type":s=e.source_type,t=l.source_type;break;case"created_at":s=e.created_at?new Date(e.created_at).getTime():0,t=l.created_at?new Date(l.created_at).getTime():0;break;default:return 0}return s<t?"asc"===lb.order?-1:1:s>t?"asc"===lb.order?1:-1:0}),e},l5=e=>{let l={wait:{color:"default",text:"待处理"},processing:{color:"processing",text:"处理中"},downloading:{color:"processing",text:"下载中"},success:{color:"success",text:"已完成"},failed:{color:"error",text:"失败"},retrying:{color:"warning",text:"重试中"}};return l[e]||l.wait},l3=e=>{let l=l8();e?ln(l.map(e=>e.file_id)):ln([])},l9=(e,l)=>{l?ln([...lt,e]):ln(lt.filter(l=>l!==e))},l7=e=>!!e.file_type&&[".txt",".doc",".docx",".pdf",".md",".rtf",".xlsx",".csv"].some(l=>{var s;return null===(s=e.file_type)||void 0===s?void 0:s.toLowerCase().includes(l.toLowerCase())}),se=e=>!!e.file_type&&[".wav",".mp3",".mp4",".flac",".aac",".m4a",".wma"].some(l=>{var s;return null===(s=e.file_type)||void 0===s?void 0:s.toLowerCase().includes(l.toLowerCase())}),sl=e=>"ftp"===e.source_type?(0,i.jsx)($.Z,{color:"blue",size:"small",children:"FTP扫描"}):"stt"===e.source_type?(0,i.jsx)($.Z,{color:"green",size:"small",children:"语音转换"}):(0,i.jsx)($.Z,{color:"default",size:"small",children:"未知来源"}),ss=[{title:(0,i.jsx)(ee.Z,{checked:lt.length===l8().length&&l8().length>0,indeterminate:lt.length>0&&lt.length<l8().length,onChange:e=>l3(e.target.checked),children:"文件名"}),dataIndex:"file_name",key:"file_name",width:"400px",render:(e,l)=>(0,i.jsxs)(el.Z,{children:[(0,i.jsx)(ee.Z,{checked:lt.includes(l.file_id),onChange:e=>l9(l.file_id,e.target.checked)}),(0,i.jsx)(z.Z,{}),(0,i.jsx)("span",{children:e})]})},{title:"来源",dataIndex:"source_type",key:"source_type",width:"300px",render:(e,l)=>(0,i.jsxs)(el.Z,{direction:"vertical",size:4,children:[sl(l),(0,i.jsx)(ep,{type:"secondary",style:{fontSize:11},children:l.source_id})]})},{title:"文件类型",dataIndex:"file_type",key:"file_type",width:"100px",render:(e,l)=>se(l)?(0,i.jsx)($.Z,{color:"purple",size:"small",children:"音频"}):l7(l)?(0,i.jsx)($.Z,{color:"orange",size:"small",children:"文本"}):(0,i.jsx)($.Z,{color:"default",size:"small",children:e||"其他"})},{title:"大小",dataIndex:"size",key:"size",width:"100px",render:e=>e?e<1024?"".concat(e,"B"):e<1048576?"".concat((e/1024).toFixed(1),"KB"):"".concat((e/1024/1024).toFixed(1),"MB"):"-"},{title:"状态",dataIndex:"status",key:"status",width:"120px",render:(e,l)=>{let s=l5(e);return"wait"===e&&"ftp"===l.source_type?(0,i.jsx)(Y.Z,{status:"default",text:"待转换"}):(0,i.jsx)(Y.Z,{status:s.color,text:s.text})}},{title:"处理器/操作",key:"actions",width:"400px",render:(e,l)=>{let s=l7(l),t=se(l),n="success"===l.status,a="stt"===l.source_type,r="ftp"===l.source_type;return(0,i.jsxs)(el.Z,{direction:"vertical",size:4,children:[(0,i.jsxs)("div",{children:[r&&(0,i.jsx)($.Z,{size:"small",color:"blue",children:"文件扫描"}),t&&a&&(0,i.jsx)($.Z,{size:"small",color:"purple",children:"语音转换"}),s&&a&&(0,i.jsx)($.Z,{size:"small",color:"orange",children:"知识库处理"})]}),(0,i.jsxs)(el.Z,{size:"small",children:[s&&n&&(0,i.jsx)(es.Z,{title:"跳转到知识库",children:(0,i.jsx)(et.ZP,{size:"small",type:"primary",icon:(0,i.jsx)(T.Z,{}),onClick:()=>l2(l),style:{backgroundColor:"#52c41a",borderColor:"#52c41a"},children:"知识库"})}),s&&!n&&(0,i.jsx)(es.Z,{title:"文件处理完成后可跳转知识库",children:(0,i.jsx)(et.ZP,{size:"small",type:"default",icon:(0,i.jsx)(T.Z,{}),disabled:!0,style:{color:"#999"},children:"知识库"})}),(0,i.jsx)(es.Z,{title:"下载文件",children:(0,i.jsx)(et.ZP,{size:"small",type:"text",icon:(0,i.jsx)(I.Z,{}),onClick:()=>l6(l)})}),("failed"===l.status||"wait"===l.status)&&(0,i.jsx)(es.Z,{title:"重新处理",children:(0,i.jsx)(et.ZP,{size:"small",type:"text",icon:(0,i.jsx)(F.Z,{}),onClick:()=>l4([l.file_id]),style:{color:"#fa8c16"}})})]})]})}},{title:"时间",dataIndex:"created_at",key:"created_at",width:"200px",render:e=>e?new Date(e).toLocaleString():"-"}],st=[{title:"配置名称",dataIndex:"name",key:"name",width:"20%"},{title:"类型",dataIndex:"type",key:"type",width:"10%",render:e=>(0,i.jsx)($.Z,{color:"ftp"===e?"blue":"green",children:"ftp"===e?"FTP":"本地"})},{title:"配置信息",dataIndex:"config",key:"config",width:"25%",render:(e,l)=>"ftp"===l.type?"".concat(e.host,":").concat(e.port||21).concat(e.remote_dir||"/"):e.path||"-"},{title:"文件类型",dataIndex:"config",key:"file_types",width:"25%",render:e=>{let l=lk.filter(e=>e.enabled);return 0===l.length?"-":(0,i.jsxs)("div",{children:[l.slice(0,3).map(e=>(0,i.jsx)($.Z,{size:"small",style:{marginBottom:2},children:e.extension},e.extension)),l.length>3&&(0,i.jsx)(es.Z,{title:l.slice(3).map(e=>e.extension).join(", "),children:(0,i.jsxs)($.Z,{size:"small",style:{marginBottom:2},children:["+",l.length-3]})}),(0,i.jsxs)("div",{style:{fontSize:11,color:"#999",marginTop:4},children:["(全局配置: ",l.length,"个)"]})]})}},{title:"状态",dataIndex:"enabled",key:"enabled",width:"10%",render:(e,l)=>(0,i.jsx)(en.Z,{size:"small",checked:e,onChange:()=>l$(l)})},{title:"操作",key:"action",width:"10%",render:(e,l)=>(0,i.jsxs)(el.Z,{size:"small",children:["ftp"===l.type&&(0,i.jsx)(es.Z,{title:"测试连接",children:(0,i.jsx)(et.ZP,{size:"small",type:"text",icon:(0,i.jsx)(R.Z,{}),onClick:()=>lE(l,!1),loading:eH})}),(0,i.jsx)(es.Z,{title:"编辑",children:(0,i.jsx)(et.ZP,{size:"small",type:"text",icon:(0,i.jsx)(B.Z,{}),onClick:()=>lW(l)})}),(0,i.jsx)(es.Z,{title:"删除",children:(0,i.jsx)(et.ZP,{size:"small",type:"text",danger:!0,icon:(0,i.jsx)(L.Z,{}),onClick:()=>l0(l)})})]})}];ee.Z,lt.length===l8().length&&l8().length,lt.length>0&&(lt.length,l8().length),(e,l)=>(0,i.jsxs)(el.Z,{children:[(0,i.jsx)(ee.Z,{checked:lt.includes(l.file_id),onChange:e=>l9(l.file_id,e.target.checked)}),(0,i.jsx)(z.Z,{}),(0,i.jsx)("span",{children:e})]});let sn=(e,l)=>{lB(s=>s.map((s,t)=>t===e?{...s,scan_config_name:l}:s))},si=async()=>{let e=lR.filter(e=>!e.scan_config_name||!e.knowledge_base_id);if(e.length>0){J.ZP.warning("请完善所有映射配置信息");return}let l=lR.filter(e=>e.scan_config_name).map(e=>e.scan_config_name),s=l.filter((e,s)=>l.indexOf(e)!==s);if(s.length>0){J.ZP.warning('扫描配置 "'.concat(s[0],'" 存在重复映射'));return}try{eX(!0);let e=lR.filter(e=>e.scan_config_name&&e.knowledge_base_id).map(e=>({...e,enabled:!0})),[l]=await (0,a.Vx)(w({mappings:e}));l||J.ZP.success("知识库映射配置保存成功 (".concat(e.length,"个映射)"))}catch(e){console.error("保存映射配置失败:",e),J.ZP.error("保存映射配置失败")}finally{eX(!1)}},sa=async e=>{let l=lR[e];if(l.scan_config_name)try{eX(!0);let[s]=await (0,a.Vx)(k({mappings:[l]}));s||(J.ZP.success('映射配置 "'.concat(l.scan_config_name,'" 删除成功')),lB(l=>l.filter((l,s)=>s!==e)))}catch(e){console.error("删除映射配置失败:",e),J.ZP.error("删除映射配置失败")}finally{eX(!1)}else lB(l=>l.filter((l,s)=>s!==e)),J.ZP.info("已删除未保存的映射配置")},sr=(e,l)=>{let s=lI.find(e=>e.space_id===l);lB(t=>t.map((t,n)=>n===e?{...t,knowledge_base_id:l.toString(),knowledge_base_name:(null==s?void 0:s.param)||""}:t))};return(0,i.jsxs)("div",{style:{padding:"0 24px"},children:[(0,i.jsxs)(eh,{level:2,style:{marginBottom:24},children:[(0,i.jsx)(V.Z,{})," 自动化加工模块"]}),(0,i.jsx)(el.Z,{direction:"vertical",style:{width:"100%"},size:24,children:(0,i.jsxs)(ei.Z,{title:(0,i.jsxs)(el.Z,{children:[(0,i.jsx)(z.Z,{}),(0,i.jsx)("span",{children:"文件管理"}),(0,i.jsxs)($.Z,{color:"blue",children:[eL.length," 个文件"]}),(0,i.jsxs)($.Z,{color:"cyan",children:[eL.filter(e=>"ftp"===e.source_type).length," 个扫描文件"]}),(0,i.jsxs)($.Z,{color:"green",children:[eL.filter(e=>"stt"===e.source_type).length," 个转换文件"]})]}),size:"small",extra:(0,i.jsxs)(el.Z,{children:[(0,i.jsx)(et.ZP,{size:"small",icon:(0,i.jsx)(R.Z,{}),onClick:()=>lu(!0),children:"扫描配置"}),(0,i.jsx)(et.ZP,{size:"small",icon:(0,i.jsx)(V.Z,{}),onClick:()=>lp(!0),children:"加工配置"}),(0,i.jsxs)(ep,{type:"secondary",style:{fontSize:12},children:[(0,i.jsx)(N.Z,{})," FTP文件: ",(null==eR?void 0:null===(e=eR.source_type_statistics)||void 0===e?void 0:e.ftp)||0," | 转换文件:"," ",(null==eR?void 0:null===(l=eR.source_type_statistics)||void 0===l?void 0:l.stt)||0]})]}),style:{minHeight:600},children:[(0,i.jsxs)("div",{style:{marginBottom:16,padding:"12px 16px",backgroundColor:"#f5f5f5",borderRadius:4},children:[(0,i.jsxs)(ea.Z,{justify:"space-between",align:"middle",children:[(0,i.jsx)(er.Z,{children:(0,i.jsxs)(el.Z,{children:[(0,i.jsx)(N.Z,{}),(0,i.jsx)(ep,{strong:!0,children:"定时扫描任务"}),(()=>{let e=(null==eJ?void 0:eJ.config.enabled)||!1,l=(null==eJ?void 0:eJ.running)||!1;return e?l?(0,i.jsx)(Y.Z,{status:"processing",text:"运行中"}):(0,i.jsx)(Y.Z,{status:"warning",text:"已启用但未运行"}):(0,i.jsx)(Y.Z,{status:"default",text:"已停用"})})()]})}),(0,i.jsx)(er.Z,{children:(0,i.jsxs)(el.Z,{children:[(0,i.jsx)(en.Z,{size:"small",checked:(null==eJ?void 0:eJ.running)||!1,onChange:lQ,loading:eH,checkedChildren:"运行",unCheckedChildren:"停止"}),(0,i.jsx)(et.ZP,{size:"small",type:"link",onClick:()=>e2(!0),style:{padding:0},children:"设置"})]})})]}),(null==eJ?void 0:eJ.config.enabled)&&(null==eJ?void 0:eJ.config.interval_seconds)&&(0,i.jsx)("div",{style:{marginTop:8,fontSize:12,color:"#666"},children:(0,i.jsxs)(el.Z,{split:(0,i.jsx)("span",{style:{color:"#d9d9d9"},children:"|"}),children:[(0,i.jsxs)("span",{children:["间隔: ",eJ.config.interval_seconds," 秒"]}),(null==eJ?void 0:eJ.next_run)&&(0,i.jsxs)("span",{children:["下次运行: ",new Date(eJ.next_run).toLocaleString()]})]})})]}),(0,i.jsx)("div",{style:{marginBottom:16,padding:"12px 16px",backgroundColor:"#f0f8ff",borderRadius:4},children:(0,i.jsxs)(ea.Z,{justify:"space-between",align:"middle",children:[(0,i.jsx)(er.Z,{children:(0,i.jsxs)(el.Z,{children:[(0,i.jsx)(E.Z,{style:{color:"#1890ff"}}),(0,i.jsx)(ep,{strong:!0,children:"语音转换处理器"}),(0,i.jsx)(Y.Z,{status:(null==li?void 0:null===(s=li.processors)||void 0===s?void 0:null===(t=s.audio_to_text)||void 0===t?void 0:t.consuming)?"processing":"default",text:(null==li?void 0:null===(n=li.processors)||void 0===n?void 0:null===(K=n.audio_to_text)||void 0===K?void 0:K.consuming)?"运行中":"已停止"})]})}),(0,i.jsx)(er.Z,{children:(0,i.jsx)(en.Z,{checked:(null==li?void 0:null===(eg=li.processors)||void 0===eg?void 0:null===(ey=eg.audio_to_text)||void 0===ey?void 0:ey.consuming)||!1,onChange:e=>lH(e?"start":"stop"),loading:lr,checkedChildren:"运行",unCheckedChildren:"停止"})})]})}),(0,i.jsx)("div",{style:{marginBottom:16,padding:"12px 16px",backgroundColor:"#f6ffed",borderRadius:4},children:(0,i.jsxs)(ea.Z,{justify:"space-between",align:"middle",children:[(0,i.jsx)(er.Z,{children:(0,i.jsxs)(el.Z,{children:[(0,i.jsx)(T.Z,{style:{color:"#52c41a"}}),(0,i.jsx)(ep,{strong:!0,children:"知识库处理器"}),(0,i.jsx)(Y.Z,{status:(null==li?void 0:null===(ev=li.processors)||void 0===ev?void 0:null===(eZ=ev.knowledge_processor)||void 0===eZ?void 0:eZ.consuming)?"processing":"default",text:(null==li?void 0:null===(eb=li.processors)||void 0===eb?void 0:null===(ew=eb.knowledge_processor)||void 0===ew?void 0:ew.consuming)?"运行中":"已停止"})]})}),(0,i.jsx)(er.Z,{children:(0,i.jsx)(en.Z,{checked:(null==li?void 0:null===(ek=li.processors)||void 0===ek?void 0:null===(eP=ek.knowledge_processor)||void 0===eP?void 0:eP.consuming)||!1,onChange:e=>lX(e?"start":"stop"),loading:lo,checkedChildren:"运行",unCheckedChildren:"停止"})})]})}),(0,i.jsx)("div",{style:{marginBottom:16,padding:"12px 16px",backgroundColor:"#f5f5f5",borderRadius:4},children:(0,i.jsxs)(ea.Z,{gutter:16,children:[(0,i.jsx)(er.Z,{span:8,children:(0,i.jsxs)("div",{style:{textAlign:"center",padding:"8px",backgroundColor:"#f0f9ff",borderRadius:4},children:[(0,i.jsx)("div",{style:{fontSize:16,fontWeight:"bold",color:"#1890ff"},children:(null==eR?void 0:null===(eC=eR.source_type_statistics)||void 0===eC?void 0:eC.ftp)||0}),(0,i.jsx)("div",{style:{fontSize:12,color:"#666"},children:"FTP扫描文件"})]})}),(0,i.jsx)(er.Z,{span:8,children:(0,i.jsxs)("div",{style:{textAlign:"center",padding:"8px",backgroundColor:"#f6ffed",borderRadius:4},children:[(0,i.jsx)("div",{style:{fontSize:16,fontWeight:"bold",color:"#52c41a"},children:(null==eR?void 0:null===(e_=eR.source_type_statistics)||void 0===e_?void 0:e_.stt)||0}),(0,i.jsx)("div",{style:{fontSize:12,color:"#666"},children:"语音转换文件"})]})}),(0,i.jsx)(er.Z,{span:8,children:(0,i.jsxs)("div",{style:{textAlign:"center",padding:"8px",backgroundColor:"#fff7e6",borderRadius:4},children:[(0,i.jsx)("div",{style:{fontSize:16,fontWeight:"bold",color:"#fa8c16"},children:(null==eR?void 0:null===(eS=eR.status_statistics)||void 0===eS?void 0:eS.success)||0}),(0,i.jsx)("div",{style:{fontSize:12,color:"#666"},children:"处理成功"})]})})]})}),(0,i.jsx)("div",{style:{marginBottom:16,padding:"12px 16px",backgroundColor:"#f5f5f5",borderRadius:4},children:(0,i.jsxs)(ea.Z,{justify:"space-between",align:"middle",children:[(0,i.jsx)(er.Z,{children:(0,i.jsxs)(el.Z,{children:[(0,i.jsx)(es.Z,{title:eD||0!==ez.filter(e=>e.enabled).length?"":"请先在扫描配置列表中启用至少一个配置项",placement:"top",children:(0,i.jsx)(et.ZP,{type:"primary",icon:eD?(0,i.jsx)(D.Z,{}):(0,i.jsx)(O.Z,{}),onClick:eD?()=>{eO(!1),J.ZP.info("已停止扫描")}:lY,loading:eD,disabled:!eD&&0===ez.filter(e=>e.enabled).length,children:eD?"停止扫描":"开始扫描"})}),(0,i.jsxs)(et.ZP,{danger:!0,icon:(0,i.jsx)(L.Z,{}),onClick:()=>{em({title:"确认清空",content:"确定要清空所有文件记录吗？这将重置所有扫描和处理状态。",onOk:async()=>{try{let[e]=await (0,a.Vx)(S());e||(J.ZP.success("已清空所有文件记录"),lU(),lM())}catch(e){console.error("清空文件记录失败:",e)}}})},disabled:0===eL.length,children:["清空记录 (",eL.length,")"]})]})}),(0,i.jsx)(er.Z,{children:(0,i.jsxs)(el.Z,{children:[(0,i.jsxs)(et.ZP,{type:"primary",size:"small",icon:(0,i.jsx)(I.Z,{}),onClick:()=>{if(0===lt.length){J.ZP.warning("请先选择要下载的文件");return}lt.forEach(e=>{let l=eL.find(l=>l.file_id===e);l&&l6(l)})},children:["下载 (",lt.length,")"]}),(0,i.jsxs)(et.ZP,{type:"default",size:"small",icon:(0,i.jsx)(F.Z,{}),onClick:l4,children:["重新处理 (",lt.length,")"]}),(0,i.jsxs)(et.ZP,{danger:!0,size:"small",icon:(0,i.jsx)(L.Z,{}),onClick:()=>{if(0===lt.length){J.ZP.warning("请先选择要删除的文件");return}l1(lt)},children:["删除 (",lt.length,")"]}),(0,i.jsx)(et.ZP,{size:"small",type:lm?"primary":"default",icon:(0,i.jsx)(U.Z,{spin:lm}),onClick:()=>{lf(!lm),J.ZP.info(lm?"自动刷新已停止":"自动刷新已启用 (1秒间隔)")},children:lm?"停止自动刷新":"启用自动刷新"}),(0,i.jsx)(et.ZP,{size:"small",icon:(0,i.jsx)(F.Z,{}),onClick:()=>{lA(),lM(),lU(),lq(),J.ZP.info("数据已刷新")},children:"手动刷新"})]})})]})}),(0,i.jsx)("div",{style:{marginBottom:16,padding:"8px 12px",backgroundColor:"#f0f9ff",borderRadius:4,border:"1px solid #bae6fd"},children:(0,i.jsxs)(ea.Z,{gutter:8,align:"middle",children:[(0,i.jsx)(er.Z,{span:5,children:(0,i.jsx)(ed.default,{size:"small",placeholder:"搜索文件名",prefix:(0,i.jsx)(A.Z,{}),value:lv.nameSearch,onChange:e=>lZ(l=>({...l,nameSearch:e.target.value})),allowClear:!0})}),(0,i.jsx)(er.Z,{span:3,children:(0,i.jsxs)(X.default,{size:"small",placeholder:"状态筛选",value:lv.status,onChange:e=>lZ(l=>({...l,status:e})),style:{width:"100%"},allowClear:!0,children:[(0,i.jsx)(eu,{value:"wait",children:"待处理"}),(0,i.jsx)(eu,{value:"processing",children:"处理中"}),(0,i.jsx)(eu,{value:"downloading",children:"下载中"}),(0,i.jsx)(eu,{value:"success",children:"已完成"}),(0,i.jsx)(eu,{value:"failed",children:"失败"}),(0,i.jsx)(eu,{value:"retrying",children:"重试中"})]})}),(0,i.jsx)(er.Z,{span:3,children:(0,i.jsxs)(X.default,{size:"small",placeholder:"来源筛选",value:lv.source_type,onChange:e=>lZ(l=>({...l,source_type:e})),style:{width:"100%"},allowClear:!0,children:[(0,i.jsx)(eu,{value:"ftp",children:"FTP扫描"}),(0,i.jsx)(eu,{value:"stt",children:"语音转换"})]})}),(0,i.jsx)(er.Z,{span:3,children:(0,i.jsxs)(X.default,{size:"small",placeholder:"文件类型",value:lv.file_type,onChange:e=>lZ(l=>({...l,file_type:e})),style:{width:"100%"},allowClear:!0,children:[(0,i.jsx)(eu,{value:"wav",children:"音频文件"}),(0,i.jsx)(eu,{value:"txt",children:"文本文件"}),(0,i.jsx)(eu,{value:"pdf",children:"PDF文档"}),(0,i.jsx)(eu,{value:"doc",children:"Word文档"})]})}),(0,i.jsx)(er.Z,{span:4,children:(0,i.jsxs)(X.default,{size:"small",placeholder:"排序方式",value:"".concat(lb.field,"_").concat(lb.order),onChange:e=>{let[l,s]=e.split("_");lw({field:l,order:s})},style:{width:"100%"},children:[(0,i.jsx)(eu,{value:"file_name_asc",children:"文件名 ↑"}),(0,i.jsx)(eu,{value:"file_name_desc",children:"文件名 ↓"}),(0,i.jsx)(eu,{value:"size_asc",children:"大小 ↑"}),(0,i.jsx)(eu,{value:"size_desc",children:"大小 ↓"}),(0,i.jsx)(eu,{value:"created_at_desc",children:"时间 ↓"}),(0,i.jsx)(eu,{value:"created_at_asc",children:"时间 ↑"}),(0,i.jsx)(eu,{value:"source_type_asc",children:"来源 ↑"}),(0,i.jsx)(eu,{value:"source_type_desc",children:"来源 ↓"})]})}),(0,i.jsx)(er.Z,{span:2,children:(0,i.jsx)(et.ZP,{size:"small",icon:(0,i.jsx)(M.Z,{}),onClick:()=>{lZ({status:"",source_type:"",file_type:"",nameSearch:""}),J.ZP.info("已重置所有过滤条件")},style:{width:"100%"},children:"重置"})}),(0,i.jsx)(er.Z,{span:4,children:(0,i.jsxs)(ep,{type:"secondary",style:{fontSize:11},children:["共 ",l8().length," 条 | 已选 ",lt.length," 条"]})})]})}),(0,i.jsx)(eo.Z,{dataSource:l8(),columns:ss,rowKey:"file_id",size:"small",pagination:{pageSize:20,showSizeChanger:!0,showQuickJumper:!0,showTotal:(e,l)=>"第 ".concat(l[0],"-").concat(l[1]," 条/共 ").concat(e," 条"),pageSizeOptions:["10","20","50","100"]},scroll:{y:400},loading:ll})]})}),(0,i.jsx)(G.default,{title:(0,i.jsxs)(el.Z,{children:[(0,i.jsx)(R.Z,{}),(0,i.jsx)("span",{children:"扫描配置列表"}),(0,i.jsxs)($.Z,{color:"blue",children:[ez.length," 个配置"]})]}),open:lx,onCancel:()=>lu(!1),footer:null,width:1e3,destroyOnClose:!0,children:(0,i.jsxs)(el.Z,{direction:"vertical",style:{width:"100%"},size:16,children:[(0,i.jsx)("div",{style:{marginBottom:16},children:(0,i.jsxs)(el.Z,{children:[(0,i.jsx)(et.ZP,{type:"primary",icon:(0,i.jsx)(U.Z,{}),onClick:()=>{eG(!0),eE({}),eW.resetFields()},children:"添加FTP配置"}),(0,i.jsx)(et.ZP,{icon:(0,i.jsx)(z.Z,{}),onClick:()=>{lz(!0),setTimeout(()=>{lT.setFieldsValue({fileTypes:lk.filter(e=>e.enabled).map(e=>e.extension)})},100)},children:"文件类型配置"}),(0,i.jsx)(et.ZP,{icon:(0,i.jsx)(R.Z,{}),onClick:lJ,children:"测试所有连接"}),(0,i.jsx)(et.ZP,{icon:(0,i.jsx)(F.Z,{}),onClick:()=>{lA(),lU(),lM()},children:"刷新配置"})]})}),(0,i.jsx)(eo.Z,{dataSource:ez,columns:st,rowKey:"id",size:"small",pagination:{pageSize:10,showSizeChanger:!0,showQuickJumper:!0},scroll:{y:400},loading:eH})]})}),(0,i.jsx)(G.default,{title:(0,i.jsxs)(el.Z,{children:[(0,i.jsx)(V.Z,{}),(0,i.jsx)("span",{children:"配置中心"})]}),open:lh,onCancel:()=>lp(!1),footer:null,width:800,destroyOnClose:!0,children:(0,i.jsx)(el.Z,{direction:"vertical",style:{width:"100%"},size:16,children:(0,i.jsxs)(W.default,{activeKey:eM,onChange:eq,expandIcon:e=>{let{isActive:l}=e;return(0,i.jsx)(q.Z,{rotate:l?90:0})},size:"small",ghost:!0,children:[(0,i.jsx)(ef,{header:(0,i.jsxs)(el.Z,{children:[(0,i.jsx)(E.Z,{}),(0,i.jsx)("span",{children:"语音加工配置"}),(null==e7?void 0:e7.running)&&(0,i.jsx)(Y.Z,{status:"success"})]}),children:(0,i.jsxs)(Q.default,{size:"small",layout:"vertical",children:[(0,i.jsxs)(ea.Z,{gutter:8,children:[(0,i.jsx)(er.Z,{span:12,children:(0,i.jsx)(Q.default.Item,{label:"语言",style:{marginBottom:8},children:(0,i.jsxs)(X.default,{size:"small",value:lg.language,onChange:e=>ly(l=>({...l,language:e})),children:[(0,i.jsx)(eu,{value:"auto",children:"自动"}),(0,i.jsx)(eu,{value:"zh",children:"中文"}),(0,i.jsx)(eu,{value:"en",children:"英文"}),(0,i.jsx)(eu,{value:"yue",children:"粤语"})]})})}),(0,i.jsx)(er.Z,{span:12,children:(0,i.jsx)(Q.default.Item,{label:"批量数",style:{marginBottom:8},children:(0,i.jsx)(ec.Z,{size:"small",min:1,max:100,value:lg.batchSize,onChange:e=>ly(l=>({...l,batchSize:e||10})),style:{width:"100%"}})})})]}),(0,i.jsx)(Q.default.Item,{style:{marginBottom:0},children:(0,i.jsx)(et.ZP,{type:"primary",size:"small",onClick:()=>{J.ZP.success("语音配置已保存")},style:{width:"100%"},children:"保存语音配置"})})]})},"1"),(0,i.jsx)(ef,{header:(0,i.jsxs)(el.Z,{children:[(0,i.jsx)(T.Z,{}),(0,i.jsx)("span",{children:"知识库加工配置"}),(null==e7?void 0:e7.running)&&(0,i.jsx)(Y.Z,{status:"success"})]}),children:(0,i.jsxs)(Q.default,{size:"small",layout:"vertical",children:[(0,i.jsx)(Q.default.Item,{label:"支持文件类型",style:{marginBottom:16},children:(0,i.jsx)("div",{style:{padding:"8px 12px",backgroundColor:"#f5f5f5",borderRadius:4},children:(0,i.jsxs)(el.Z,{wrap:!0,children:[(0,i.jsx)($.Z,{color:"blue",children:".txt"}),(0,i.jsx)($.Z,{color:"blue",children:".doc"}),(0,i.jsx)($.Z,{color:"blue",children:".docx"}),(0,i.jsx)($.Z,{color:"blue",children:".pdf"}),(0,i.jsx)($.Z,{color:"green",children:"转换后的语音文本"})]})})}),(0,i.jsxs)(Q.default.Item,{label:(0,i.jsxs)(el.Z,{children:[(0,i.jsx)("span",{children:"扫描配置-知识库映射"}),(0,i.jsxs)($.Z,{color:"blue",size:"small",children:[lR.length,"个映射配置"]})]}),style:{marginBottom:16},children:[(0,i.jsx)("div",{style:{marginBottom:8},children:lR.map((e,l)=>(0,i.jsxs)("div",{style:{display:"flex",alignItems:"center",marginBottom:8,padding:"8px 12px",backgroundColor:"#f9f9f9",borderRadius:4,border:"1px solid #e8e8e8"},children:[(0,i.jsx)("div",{style:{flex:1,marginRight:8},children:(0,i.jsx)(X.default,{placeholder:"选择扫描配置",size:"small",style:{width:"100%"},value:e.scan_config_name,onChange:e=>sn(l,e),children:ez.map(e=>{var l;return(0,i.jsx)(eu,{value:e.name,children:(0,i.jsxs)(el.Z,{children:[(0,i.jsx)($.Z,{color:"ftp"===e.type?"blue":"green",size:"small",children:"ftp"===e.type?"FTP":"本地"}),(0,i.jsx)("span",{children:e.name}),"ftp"===e.type&&(null===(l=e.config)||void 0===l?void 0:l.remote_dir)&&(0,i.jsxs)("span",{style:{color:"#666",fontSize:"11px"},children:["(",e.config.remote_dir,")"]})]})},e.name)})})}),(0,i.jsx)("div",{style:{flex:1,marginRight:8},children:(0,i.jsx)(X.default,{placeholder:"选择知识库",size:"small",style:{width:"100%"},value:e.knowledge_base_id?parseInt(e.knowledge_base_id):void 0,onChange:e=>sr(l,e),children:lI.map(e=>(0,i.jsx)(eu,{value:e.space_id,children:(0,i.jsxs)(el.Z,{children:[(0,i.jsx)($.Z,{size:"small",color:"geekblue",children:"知识库"}),(0,i.jsx)("span",{children:e.param})]})},e.space_id))})}),(0,i.jsx)(et.ZP,{size:"small",type:"text",danger:!0,icon:(0,i.jsx)(L.Z,{}),onClick:()=>sa(l),loading:eH})]},l))}),(0,i.jsx)(et.ZP,{size:"small",type:"dashed",icon:(0,i.jsx)(H.Z,{}),onClick:()=>{lB(e=>[...e,{scan_config_name:"",knowledge_base_id:"",knowledge_base_name:"",enabled:!0}])},style:{width:"100%"},children:"添加映射配置"})]}),(0,i.jsx)(Q.default.Item,{style:{marginBottom:0},children:(0,i.jsxs)(ea.Z,{gutter:8,children:[(0,i.jsx)(er.Z,{span:12,children:(0,i.jsx)(et.ZP,{type:"primary",size:"small",onClick:si,loading:eH,style:{width:"100%"},icon:(0,i.jsx)(T.Z,{}),children:"保存知识库配置"})}),(0,i.jsx)(er.Z,{span:12,children:(0,i.jsx)(et.ZP,{type:"default",size:"small",icon:(0,i.jsx)(T.Z,{}),onClick:()=>{window.open("/construct/knowledge","_blank")},style:{width:"100%"},children:"打开知识库管理"})})]})})]})},"2")]})})}),(0,i.jsxs)(G.default,{title:(0,i.jsxs)(el.Z,{children:[(0,i.jsx)(z.Z,{}),(0,i.jsx)("span",{children:"全局文件类型配置"})]}),open:lS,onCancel:()=>{lz(!1),lT.resetFields()},footer:null,width:600,destroyOnClose:!0,children:[(0,i.jsx)("div",{style:{marginBottom:16,padding:"12px 16px",backgroundColor:"#f0f9ff",borderRadius:4},children:(0,i.jsxs)(ep,{type:"secondary",style:{fontSize:12},children:[(0,i.jsx)(z.Z,{style:{marginRight:4}}),"选择系统支持的文件类型。取消选择将禁用该文件类型，选择新类型将自动添加到配置中。"]})}),(0,i.jsxs)(Q.default,{form:lT,layout:"vertical",onFinish:lN,initialValues:{fileTypes:lk.filter(e=>e.enabled).map(e=>e.extension)},children:[(0,i.jsx)(Q.default.Item,{label:(0,i.jsxs)(el.Z,{children:[(0,i.jsx)("span",{children:"支持的文件类型"}),(0,i.jsxs)(ep,{type:"secondary",style:{fontSize:12},children:["(当前启用: ",lk.filter(e=>e.enabled).length,"个)"]})]}),name:"fileTypes",rules:[{required:!0,message:"请选择至少一种文件类型"}],children:(0,i.jsxs)(X.default,{mode:"multiple",placeholder:"选择要启用的文件类型",style:{width:"100%"},optionLabelProp:"label",children:[(0,i.jsx)(eu,{value:".wav",label:"WAV",children:(0,i.jsxs)(el.Z,{children:[(0,i.jsx)(E.Z,{style:{color:"#1890ff"}}),(0,i.jsx)("span",{children:"WAV 音频"})]})}),(0,i.jsx)(eu,{value:".mp3",label:"MP3",children:(0,i.jsxs)(el.Z,{children:[(0,i.jsx)(E.Z,{style:{color:"#1890ff"}}),(0,i.jsx)("span",{children:"MP3 音频"})]})}),(0,i.jsx)(eu,{value:".mp4",label:"MP4",children:(0,i.jsxs)(el.Z,{children:[(0,i.jsx)(E.Z,{style:{color:"#722ed1"}}),(0,i.jsx)("span",{children:"MP4 视频"})]})}),(0,i.jsx)(eu,{value:".flac",label:"FLAC",children:(0,i.jsxs)(el.Z,{children:[(0,i.jsx)(E.Z,{style:{color:"#1890ff"}}),(0,i.jsx)("span",{children:"FLAC 音频"})]})}),(0,i.jsx)(eu,{value:".aac",label:"AAC",children:(0,i.jsxs)(el.Z,{children:[(0,i.jsx)(E.Z,{style:{color:"#1890ff"}}),(0,i.jsx)("span",{children:"AAC 音频"})]})}),(0,i.jsx)(eu,{value:".txt",label:"TXT",children:(0,i.jsxs)(el.Z,{children:[(0,i.jsx)(z.Z,{style:{color:"#52c41a"}}),(0,i.jsx)("span",{children:"TXT 文本"})]})}),(0,i.jsx)(eu,{value:".doc",label:"DOC",children:(0,i.jsxs)(el.Z,{children:[(0,i.jsx)(z.Z,{style:{color:"#1890ff"}}),(0,i.jsx)("span",{children:"DOC 文档"})]})}),(0,i.jsx)(eu,{value:".docx",label:"DOCX",children:(0,i.jsxs)(el.Z,{children:[(0,i.jsx)(z.Z,{style:{color:"#1890ff"}}),(0,i.jsx)("span",{children:"DOCX 文档"})]})}),(0,i.jsx)(eu,{value:".pdf",label:"PDF",children:(0,i.jsxs)(el.Z,{children:[(0,i.jsx)(z.Z,{style:{color:"#f5222d"}}),(0,i.jsx)("span",{children:"PDF 文档"})]})}),(0,i.jsx)(eu,{value:".xlsx",label:"XLSX",children:(0,i.jsxs)(el.Z,{children:[(0,i.jsx)(z.Z,{style:{color:"#52c41a"}}),(0,i.jsx)("span",{children:"XLSX 表格"})]})}),(0,i.jsx)(eu,{value:".ppt",label:"PPT",children:(0,i.jsxs)(el.Z,{children:[(0,i.jsx)(z.Z,{style:{color:"#fa8c16"}}),(0,i.jsx)("span",{children:"PPT 演示文稿"})]})}),(0,i.jsx)(eu,{value:".pptx",label:"PPTX",children:(0,i.jsxs)(el.Z,{children:[(0,i.jsx)(z.Z,{style:{color:"#fa8c16"}}),(0,i.jsx)("span",{children:"PPTX 演示文稿"})]})}),(0,i.jsx)(eu,{value:".jpg",label:"JPG",children:(0,i.jsxs)(el.Z,{children:[(0,i.jsx)(z.Z,{style:{color:"#eb2f96"}}),(0,i.jsx)("span",{children:"JPG 图片"})]})}),(0,i.jsx)(eu,{value:".png",label:"PNG",children:(0,i.jsxs)(el.Z,{children:[(0,i.jsx)(z.Z,{style:{color:"#eb2f96"}}),(0,i.jsx)("span",{children:"PNG 图片"})]})})]})}),(0,i.jsx)(Q.default.Item,{style:{marginBottom:0,textAlign:"right"},children:(0,i.jsxs)(el.Z,{children:[(0,i.jsx)(et.ZP,{onClick:()=>lz(!1),children:"取消"}),(0,i.jsx)(et.ZP,{type:"primary",htmlType:"submit",loading:eH,children:"保存配置"})]})})]})]}),(0,i.jsx)(G.default,{title:"定时扫描配置",open:e6,onCancel:()=>{e2(!1),eF.resetFields()},footer:null,width:500,destroyOnClose:!0,children:(0,i.jsxs)(Q.default,{form:eF,layout:"vertical",onFinish:lK,preserve:!1,onValuesChange:(e,l)=>{console.log("表单值变化:",e),console.log("当前所有表单值:",l)},children:[(0,i.jsx)(Q.default.Item,{name:"enabled",valuePropName:"checked",style:{marginBottom:16},children:(0,i.jsx)(ee.Z,{children:"启用定时扫描"})}),(0,i.jsxs)(ea.Z,{gutter:16,children:[(0,i.jsx)(er.Z,{span:12,children:(0,i.jsx)(Q.default.Item,{name:"timeValue",label:"扫描间隔",rules:[{required:!0,message:"请输入扫描间隔"},{type:"number",min:1,message:"间隔时间必须大于0"}],children:(0,i.jsx)(ec.Z,{min:1,max:9999,placeholder:"请输入数值",style:{width:"100%"}})})}),(0,i.jsx)(er.Z,{span:12,children:(0,i.jsx)(Q.default.Item,{name:"timeUnit",label:"时间单位",children:(0,i.jsx)(X.default,{placeholder:"选择单位",children:ej.map(e=>(0,i.jsx)(eu,{value:e.value,children:e.label},e.value))})})})]}),(0,i.jsx)("div",{style:{padding:"12px 16px",backgroundColor:"#f5f5f5",borderRadius:4,marginBottom:16},children:(0,i.jsx)(ep,{type:"secondary",style:{fontSize:12},children:(0,i.jsx)(Q.default.Item,{noStyle:!0,shouldUpdate:!0,children:()=>{let e=eF.getFieldValue("timeValue"),l=eF.getFieldValue("timeUnit"),s=eF.getFieldValue("enabled");if(e&&l){var t,n;let i=(null===(t=ej.find(e=>e.value===l))||void 0===t?void 0:t.label)||"秒",a=e*((null===(n=ej.find(e=>e.value===l))||void 0===n?void 0:n.multiplier)||1);return"配置预览: ".concat(s?"启用":"停用"," | 每 ").concat(e," ").concat(i," 执行一次扫描任务 (总计 ").concat(a," 秒)")}return"配置预览: 加载中..."}})})}),(0,i.jsx)(Q.default.Item,{style:{marginBottom:0,textAlign:"right"},children:(0,i.jsxs)(el.Z,{children:[(0,i.jsx)(et.ZP,{onClick:()=>e2(!1),children:"取消"}),(0,i.jsx)(et.ZP,{type:"primary",htmlType:"submit",loading:eH,children:"保存配置"})]})})]})}),eN&&(0,i.jsx)(G.default,{title:eK?"添加FTP配置":"编辑FTP配置",open:!!eN,onCancel:()=>{eE(null),eG(!1),eW.resetFields(),eQ.resetFields()},footer:null,width:600,children:(0,i.jsxs)(Q.default,{form:eK?eW:eQ,layout:"vertical",onFinish:lG,initialValues:eK?{ftpPort:21,scanPath:"/"}:void 0,children:[(0,i.jsx)(Q.default.Item,{label:"配置名称",name:"name",rules:[{required:!0,message:"请输入配置名称"}],children:(0,i.jsx)(ed.default,{placeholder:"FTP配置名称"})}),(0,i.jsx)(Q.default.Item,{label:"FTP服务器",name:"ftpHost",rules:[{required:!0,message:"请输入FTP服务器地址"}],children:(0,i.jsx)(ed.default,{placeholder:"服务器地址"})}),(0,i.jsxs)(ea.Z,{gutter:16,children:[(0,i.jsx)(er.Z,{span:12,children:(0,i.jsx)(Q.default.Item,{label:"端口",name:"ftpPort",rules:[{required:!0,message:"请输入端口"}],children:(0,i.jsx)(ec.Z,{min:1,max:65535,placeholder:"21",style:{width:"100%"}})})}),(0,i.jsx)(er.Z,{span:12,children:(0,i.jsx)(Q.default.Item,{label:"远程目录",name:"scanPath",children:(0,i.jsx)(ed.default,{placeholder:"/upload"})})})]}),(0,i.jsxs)(ea.Z,{gutter:16,children:[(0,i.jsx)(er.Z,{span:12,children:(0,i.jsx)(Q.default.Item,{label:"用户名",name:"ftpUser",rules:[{required:!0,message:"请输入用户名"}],children:(0,i.jsx)(ed.default,{placeholder:"FTP用户名"})})}),(0,i.jsx)(er.Z,{span:12,children:(0,i.jsx)(Q.default.Item,{label:"密码",name:"ftpPassword",rules:[{required:!0,message:"请输入密码"}],children:(0,i.jsx)(ed.default.Password,{placeholder:"FTP密码"})})})]}),!eK&&(0,i.jsx)(Q.default.Item,{label:"状态",name:"enabled",valuePropName:"checked",children:(0,i.jsx)(en.Z,{})}),(0,i.jsx)(Q.default.Item,{style:{marginBottom:0,textAlign:"right"},children:(0,i.jsxs)(el.Z,{children:[(0,i.jsx)(et.ZP,{block:!0,icon:(0,i.jsx)(R.Z,{}),onClick:()=>{(eK?eW:eQ).validateFields().then(e=>{lE(e,!0)}).catch(e=>{J.ZP.warning("请先完善FTP配置信息再进行测试")})},loading:eH,type:"dashed",children:"测试FTP连接"}),(0,i.jsx)(et.ZP,{onClick:()=>{eE(null),eG(!1),eW.resetFields(),eQ.resetFields()},children:"取消"}),(0,i.jsx)(et.ZP,{type:"primary",htmlType:"submit",loading:eH,children:eK?"添加配置":"保存修改"})]})})]})})]})},ey=s(8751),ev=s(18429),eZ=s(64082),eb=s(16596),ew=s(23799),ek=s(38703),eP=s(96074);let eC=(e,l)=>{let s=Object.keys(l).filter(e=>void 0!==l[e]).map(e=>"".concat(encodeURIComponent(e),"=").concat(encodeURIComponent(l[e]))).join("&");return s?"".concat(e,"?").concat(s):e},e_=e=>{let{dbType:l,dbHost:s,dbPort:t,dbName:n,dbUser:i,dbPassword:r,autoCreate:d,sheetNames:o,tablePrefix:c,tableMapping:x,chunkSize:u,ifExists:h,columnMapping:p,fileData:m,config:f}=e,j={dbType:l,dbHost:s,dbPort:t,dbName:n,dbUser:i,autoCreate:d,chunkSize:u,ifExists:h};o&&(j.sheetNames=o),c&&(j.tablePrefix=c),x&&(j.tableMapping=x),p&&(j.columnMapping=p);let g=eC("/api/v1/expand/dataprocess/excel2db",j);return m.append("dbPassword",r),(0,a.a4)(g,m,{headers:{"Content-Type":"multipart/form-data"},...f})},{Text:eS}=K.default,{Dragger:ez}=ew.default,{Option:eT}=X.default,eI=[{label:"MySQL",value:"mysql"},{label:"PostgreSQL",value:"postgresql"},{label:"SQL Server",value:"sqlserver"},{label:"Oracle",value:"oracle"},{label:"SQLite",value:"sqlite"}];var eF=()=>{let[e,l]=(0,ex.useState)([]),[s,t]=(0,ex.useState)(!1),[n,r]=(0,ex.useState)(null),[d,o]=J.ZP.useMessage(),[c]=Q.default.useForm(),[x,u]=(0,ex.useState)({}),h=async l=>{if(0===e.length){d.error("请先上传Excel文件");return}t(!0);try{d.loading({content:"正在处理 ".concat(e.length," 个Excel文件..."),key:"db-process",duration:0});let s=new FormData;e.forEach(e=>{s.append("files",e)});let t={};e.forEach(e=>{t[e.uid]=0}),u(t);let[n,i]=await (0,a.Vx)(e_({...l,fileData:s,config:{timeout:36e5,onUploadProgress:l=>{let s=Math.ceil(l.loaded/(l.total||0)*100),t={};e.forEach(e=>{t[e.uid]=s}),u(t),d.loading({content:"正在处理文件... ".concat(s,"%"),key:"db-process",duration:0})}}}));if(d.destroy("db-process"),n){d.error("处理数据导入失败: ".concat(n.message));let s={fileCount:e.length,totalRows:0,processedRows:0,failedRows:0,files:e.map(e=>({fileName:e.name,filePath:"",bucket:"",totalRows:0,processedRows:0,failedRows:0,success:!1,error:n.message||"处理失败"})),tableData:[],dbInfo:{dbName:l.dbName,tables:[]}};r(s);return}r(i),0===i.failedRows?d.success("已成功处理 ".concat(i.fileCount," 个Excel文件！")):i.processedRows>0?d.warning("已处理 ".concat(i.fileCount," 个Excel文件，成功 ").concat(i.processedRows," 行，失败 ").concat(i.failedRows," 行")):d.error("所有数据处理失败")}catch(s){console.error("Processing error:",s),d.error("处理Excel文件时出错: ".concat(s.message));let l={fileCount:e.length,totalRows:0,processedRows:0,failedRows:0,files:e.map(e=>({fileName:e.name,filePath:"",bucket:"",totalRows:0,processedRows:0,failedRows:0,success:!1,error:s.message||"处理失败"})),tableData:[],dbInfo:{dbName:"",tables:[]}};r(l)}finally{t(!1)}},p=[{title:"文件名",dataIndex:"fileName",key:"fileName"},{title:"状态",key:"status",render:e=>e.success?(0,i.jsx)($.Z,{color:"green",icon:(0,i.jsx)(ey.Z,{}),children:"成功"}):(0,i.jsx)($.Z,{color:"red",icon:(0,i.jsx)(ev.Z,{}),children:"失败"})},{title:"总行数",dataIndex:"totalRows",key:"totalRows"},{title:"处理成功",dataIndex:"processedRows",key:"processedRows"},{title:"处理失败",dataIndex:"failedRows",key:"failedRows"},{title:"详情",key:"details",render:(e,l)=>l.success?(0,i.jsx)(eS,{type:"success",children:"处理成功"}):(0,i.jsx)(eS,{type:"danger",children:l.error||"未知错误"})}],m=[{title:"字段名",dataIndex:"name",key:"name"},{title:"数据类型",dataIndex:"type",key:"type"},{title:"允许为空",dataIndex:"nullable",key:"nullable",render:e=>e?"是":"否"}];return(0,i.jsxs)("div",{children:[o,(0,i.jsxs)(ei.Z,{title:"上传Excel文件",bordered:!0,style:{borderRadius:4,marginBottom:16,boxShadow:"none"},extra:e.length>0&&(0,i.jsx)(et.ZP,{icon:(0,i.jsx)(L.Z,{}),onClick:()=>{l([]),r(null),u({}),J.ZP.success("已清除所有Excel文件")},children:"清除全部"}),children:[(0,i.jsxs)(ez,{name:"file",multiple:!0,accept:".xlsx,.xls,.csv",beforeUpload:e=>(l(l=>[...l,e]),!1),onRemove:e=>{l(l=>l.filter(l=>l.uid!==e.uid)),u(l=>{let s={...l};return delete s[e.uid],s})},fileList:e,children:[(0,i.jsx)("p",{className:"ant-upload-drag-icon",children:(0,i.jsx)(eZ.Z,{})}),(0,i.jsx)("p",{className:"ant-upload-text",children:"点击或拖拽多个Excel文件到此区域上传"}),(0,i.jsx)("p",{className:"ant-upload-hint",children:"支持 .xlsx, .xls, .csv 格式的Excel文件（可多选）"})]}),e.length>0&&(0,i.jsxs)("div",{style:{marginTop:16},children:[(0,i.jsxs)(eS,{strong:!0,children:["已选择 ",e.length," 个文件："]}),(0,i.jsx)(eo.Z,{dataSource:e,columns:[{title:"文件名",dataIndex:"fileName",key:"fileName",render:(e,l)=>l.name},{title:"大小",dataIndex:"size",key:"size",render:(e,l)=>"".concat((l.size/1024).toFixed(2)," KB")},{title:"上传进度",key:"progress",render:(e,l)=>{let t=x[l.uid]||0;return s?(0,i.jsx)(ek.Z,{percent:t,size:"small"}):(0,i.jsx)($.Z,{color:"blue",children:"等待处理"})}}],rowKey:"uid",size:"small",style:{marginTop:8},pagination:e.length>5&&{pageSize:5}})]})]}),(0,i.jsx)(ei.Z,{title:"Excel导入配置",bordered:!0,style:{borderRadius:4,marginBottom:16,boxShadow:"none"},children:(0,i.jsxs)(Q.default,{form:c,layout:"vertical",onFinish:h,initialValues:{dbType:"mysql",dbHost:"localhost",dbPort:3306,dbName:"mydb",dbUser:"root",autoCreate:"是",chunkSize:"1000",ifExists:"replace"},children:[(0,i.jsx)("div",{style:{marginBottom:8},children:(0,i.jsx)(eS,{type:"secondary",children:"请配置数据库和Excel导入的相关选项"})}),(0,i.jsx)(eP.Z,{orientation:"left",children:"数据库配置"}),(0,i.jsx)(Q.default.Item,{label:"数据库类型",name:"dbType",rules:[{required:!0}],children:(0,i.jsx)(X.default,{placeholder:"选择数据库类型",children:eI.map(e=>(0,i.jsx)(eT,{value:e.value,children:e.label},e.value))})}),(0,i.jsx)(Q.default.Item,{label:"数据库主机",name:"dbHost",rules:[{required:!0}],children:(0,i.jsx)(ed.default,{placeholder:"数据库主机地址"})}),(0,i.jsx)(Q.default.Item,{label:"数据库端口",name:"dbPort",rules:[{required:!0}],tooltip:"MySQL默认端口为3306，PostgreSQL默认端口为5432",children:(0,i.jsx)(ec.Z,{style:{width:"100%"},min:1,max:65535,placeholder:"数据库端口"})}),(0,i.jsx)(Q.default.Item,{label:"数据库名称",name:"dbName",rules:[{required:!0}],children:(0,i.jsx)(ed.default,{placeholder:"数据库名称"})}),(0,i.jsx)(Q.default.Item,{label:"用户名",name:"dbUser",rules:[{required:!0}],children:(0,i.jsx)(ed.default,{placeholder:"数据库用户名"})}),(0,i.jsx)(Q.default.Item,{label:"密码",name:"dbPassword",rules:[{required:!0}],children:(0,i.jsx)(ed.default.Password,{placeholder:"数据库密码"})}),(0,i.jsx)(eP.Z,{orientation:"left",children:"导入配置"}),(0,i.jsx)(Q.default.Item,{label:"自动创建库或表",name:"autoCreate",rules:[{required:!0}],children:(0,i.jsxs)(X.default,{children:[(0,i.jsx)(eT,{value:"是",children:"是"}),(0,i.jsx)(eT,{value:"否",children:"否"})]})}),(0,i.jsx)(Q.default.Item,{label:"工作表名称",name:"sheetNames",children:(0,i.jsx)(ed.default,{placeholder:"输入工作表（sheet）名称，多个名称用逗号分隔"})}),(0,i.jsx)(Q.default.Item,{label:"表前缀",name:"tablePrefix",children:(0,i.jsx)(ed.default,{placeholder:"输入表前缀"})}),(0,i.jsx)(Q.default.Item,{label:"表映射",name:"tableMapping",children:(0,i.jsx)(ed.default.TextArea,{rows:4,placeholder:"输入表映射关系，JSON格式"})}),(0,i.jsx)(Q.default.Item,{label:"数据块大小",name:"chunkSize",children:(0,i.jsx)(ed.default,{placeholder:"输入数据块大小"})}),(0,i.jsx)(Q.default.Item,{label:"如果已存在",name:"ifExists",children:(0,i.jsxs)(X.default,{children:[(0,i.jsx)(eT,{value:"replace",children:"替换"}),(0,i.jsx)(eT,{value:"append",children:"追加"}),(0,i.jsx)(eT,{value:"fail",children:"失败"})]})}),(0,i.jsx)(Q.default.Item,{label:"列映射",name:"columnMapping",children:(0,i.jsx)(ed.default.TextArea,{rows:4,placeholder:"输入列映射关系，JSON格式"})}),(0,i.jsx)(Q.default.Item,{children:(0,i.jsx)(et.ZP,{type:"primary",htmlType:"submit",icon:(0,i.jsx)(eb.Z,{}),loading:s,disabled:0===e.length,children:"开始处理数据"})})]})}),n&&(0,i.jsx)(ei.Z,{title:"处理结果",bordered:!0,style:{borderRadius:4,marginBottom:16,boxShadow:"none"},children:(0,i.jsxs)(el.Z,{direction:"vertical",style:{width:"100%"},children:[(0,i.jsxs)("div",{children:[(0,i.jsx)(eS,{strong:!0,children:"文件总数："}),(0,i.jsxs)(eS,{children:[n.fileCount," 个文件"]})]}),(0,i.jsxs)("div",{children:[(0,i.jsx)(eS,{strong:!0,children:"总行数："}),(0,i.jsx)(eS,{children:n.totalRows})]}),(0,i.jsxs)("div",{children:[(0,i.jsx)(eS,{strong:!0,children:"处理成功："}),(0,i.jsxs)(eS,{type:"success",children:[n.processedRows," 行"]})]}),(0,i.jsxs)("div",{children:[(0,i.jsx)(eS,{strong:!0,children:"处理失败："}),(0,i.jsxs)(eS,{type:"danger",children:[n.failedRows," 行"]})]}),(0,i.jsxs)("div",{style:{marginTop:16},children:[(0,i.jsx)(eS,{strong:!0,children:"完成进度："}),(0,i.jsx)(ek.Z,{percent:100,status:n.failedRows>0?"exception":"success",style:{marginTop:8}})]}),(0,i.jsxs)("div",{style:{marginTop:16},children:[(0,i.jsx)(eS,{strong:!0,children:"文件处理详情："}),(0,i.jsx)(eo.Z,{columns:p,dataSource:n.files,rowKey:"fileName",pagination:!1,style:{marginTop:8}})]}),n.dbInfo&&n.dbInfo.tables.length>0&&(0,i.jsxs)("div",{style:{marginTop:16},children:[(0,i.jsx)(eS,{strong:!0,children:"数据库信息："}),(0,i.jsxs)("div",{style:{marginBottom:8,marginTop:8},children:[(0,i.jsx)(eS,{children:"数据库名称："}),(0,i.jsx)(eS,{strong:!0,children:n.dbInfo.dbName})]}),(0,i.jsx)(eo.Z,{columns:[{title:"表名",dataIndex:"tableName",key:"tableName"},{title:"字段数",dataIndex:"columns",key:"columnCount",render:e=>e.length}],dataSource:n.dbInfo.tables,rowKey:"tableName",pagination:!1,expandable:{expandedRowRender:e=>(0,i.jsxs)("div",{style:{margin:0},children:[(0,i.jsx)(eS,{strong:!0,children:"字段列表："}),(0,i.jsx)(eo.Z,{columns:m,dataSource:e.columns,rowKey:"name",pagination:!1,size:"small"})]})},size:"small",style:{marginTop:8}})]})]})})]})},eR=s(87547),eB=s(50888),eL=s(7134),eV=s(30568),eN=s(2487);let eE=e=>{let{language:l="zh-CN",model:s="default",enablePunctuation:t=!0,speakerDiarization:n=!0,auto_register:i=!0,threshold:r=.5,hotword:d="",fileData:o,config:c}=e,x="/api/v1/expand/voiceprocess/voice2text",u={language:l,model:s,enablePunctuation:t?"true":"false",speakerDiarization:n?"true":"false",auto_register:i,threshold:r,hotword:d},h=Object.keys(u).map(e=>"".concat(encodeURIComponent(e),"=").concat(encodeURIComponent(u[e]))).join("&"),p=h?"".concat(x,"?").concat(h):x;return(0,a.a4)(p,o,{headers:{"Content-Type":"multipart/form-data"},...c})},eD=function(){let e=!(arguments.length>0)||void 0===arguments[0]||arguments[0],l=arguments.length>1?arguments[1]:void 0;return(0,a.HT)("/api/v1/expand/voiceprofile/list?include_unnamed=".concat(e),l)},eO=(e,l,s)=>{let t=new FormData;return t.append("name",e),l&&t.append("file",l),(0,a.a4)("/api/v1/expand/voiceprofile/create",t,{headers:{"Content-Type":"multipart/form-data"},...s})},eU=(e,l,s)=>{let t=new FormData;return t.append("id",e),t.append("name",l),(0,a.a4)("/api/v1/expand/voiceprofile/update",t,{headers:{"Content-Type":"multipart/form-data"},...s})},eA=(e,l)=>{let s=new FormData;return s.append("id",e),(0,a.a4)("/api/v1/expand/voiceprofile/delete",s,{headers:{"Content-Type":"multipart/form-data"},...l})},eM=(e,l,s)=>(l.append("profileId",e),(0,a.a4)("/api/v1/expand/voiceprofile/addsample",l,{headers:{"Content-Type":"multipart/form-data"},...s})),eq=(e,l)=>{let s=new FormData;return s.append("sampleId",e),(0,a.a4)("/api/v1/expand/voiceprofile/deletesample",s,{headers:{"Content-Type":"multipart/form-data"},...l})},eH=e=>"/api/v1/expand/voiceprofile/sample/".concat(e),eX=e=>(0,a.a4)("/api/v1/expand/voiceprofile/clear",null,e),eK=(e,l)=>{let s=new FormData;return s.append("directory",e),(0,a.a4)("/api/v1/expand/voiceprofile/batchregister",s,{headers:{"Content-Type":"multipart/form-data"},...l})},{Text:eG}=K.default,{Dragger:eW}=ew.default,{Option:eQ}=X.default,eJ=[{value:"zh-CN",label:"中文 (简体)"},{value:"auto",label:"自动"}],eY=[{value:"default",label:"默认模型"},{value:"paraformer-zh",label:"中文专用模型"}];var e$=()=>{let[e,l]=(0,ex.useState)([]),[s,t]=(0,ex.useState)(!1),[n,r]=(0,ex.useState)([]),[d,o]=(0,ex.useState)([]),[c,x]=(0,ex.useState)("1"),[u,h]=(0,ex.useState)(null),[p,m]=(0,ex.useState)(""),[f,j]=(0,ex.useState)([]),[g,y]=(0,ex.useState)(null),[v,Z]=(0,ex.useState)({}),[b,w]=J.ZP.useMessage(),k=(0,ex.useRef)(null),[P,C]=(0,ex.useState)("zh-CN"),[_,S]=(0,ex.useState)("default"),[z,T]=(0,ex.useState)(!0),[F,R]=(0,ex.useState)(!0),[V,N]=(0,ex.useState)(!0),[U,A]=(0,ex.useState)(.5),[M,q]=(0,ex.useState)(""),[H,K]=(0,ex.useState)(""),[W,Q]=(0,ex.useState)(!1);(0,ex.useEffect)(()=>{Y()},[]);let Y=async()=>{let[e,l]=await (0,a.Vx)(eD(!0));if(e){b.error("获取声纹列表失败: ".concat(e.message));return}l&&l.profiles&&o(l.profiles)},ee=async()=>{if(0===e.length){b.error("请先上传音频文件");return}t(!0);try{b.loading({content:"正在处理 ".concat(e.length," 个音频文件..."),key:"voice-process",duration:0});let l=new FormData;e.forEach(e=>{l.append("files",e)});let s={};e.forEach(e=>{s[e.uid]=0}),Z(s);let[t,n]=await (0,a.Vx)(eE({language:P,model:_,enablePunctuation:z,speakerDiarization:F,auto_register:V,threshold:U,hotword:M,fileData:l,config:{timeout:3e5,onUploadProgress:l=>{let s=Math.ceil(l.loaded/(l.total||0)*100),t={};e.forEach(e=>{t[e.uid]=s}),Z(t),b.loading({content:"正在处理文件... ".concat(s,"%"),key:"voice-process",duration:0})}}}));if(b.destroy("voice-process"),t){b.error("处理语音转文字失败: ".concat(t.message));let l=e.map(e=>({fileUid:e.uid,fileName:e.name||"",text:"",processingTime:0,success:!1,error:t.message||"处理失败"}));r(l);return}n&&(r(n.files),n.autoRegisteredSpeakers&&n.autoRegisteredSpeakers>0&&(b.success("已自动注册 ".concat(n.autoRegisteredSpeakers," 个新声纹")),Y()),0===n.failedFiles?b.success("已成功处理 ".concat(n.fileCount," 个音频文件！")):n.processedFiles>0?b.warning("已处理 ".concat(n.fileCount," 个音频文件，成功 ").concat(n.processedFiles," 个，失败 ").concat(n.failedFiles," 个")):b.error("所有音频处理失败"))}catch(s){console.error("Processing error:",s),b.error("处理音频文件时出错: ".concat(s.message));let l=e.map(e=>({fileUid:e.uid,fileName:e.name||"",text:"",processingTime:0,success:!1,error:s.message||"处理失败"}));r(l)}finally{t(!1)}},es=e=>{if(!e)return;let l=document.createElement("a"),s=new Blob([e.text],{type:"text/plain"});l.href=URL.createObjectURL(s),l.download="".concat(e.fileName,"-转换结果.txt"),document.body.appendChild(l),l.click(),document.body.removeChild(l),b.success("文本文件下载成功！")},ec=async(e,l)=>{try{b.loading({content:"正在创建声纹...",key:"create-profile",duration:0});let[s,t]=await (0,a.Vx)(eO(e,l));if(b.destroy("create-profile"),s){b.error("添加声纹失败: ".concat(s.message));return}t&&(await Y(),b.success("已添加新声纹"))}catch(e){b.destroy("create-profile"),b.error("添加声纹时出错: ".concat(e.message))}},eu=e=>{h(e.id),m(e.name)},eh=async()=>{if(null!==u)try{let[e,l]=await (0,a.Vx)(eU(u,p));if(e){b.error("更新声纹名称失败: ".concat(e.message));return}l&&(await Y(),b.success("名称已更新"))}catch(e){b.error("更新声纹名称时出错: ".concat(e.message))}finally{h(null),m("")}},ep=()=>{h(null),m("")},em=e=>{G.default.confirm({title:"删除声纹",content:"确定要删除这个声纹吗？此操作不可撤销。",onOk:async()=>{try{let[l,s]=await (0,a.Vx)(eA(e));if(l){b.error("删除声纹失败: ".concat(l.message));return}s&&s.success&&(o(d.filter(l=>l.id!==e)),b.success("声纹已删除"))}catch(e){b.error("删除声纹时出错: ".concat(e.message))}}})},ef=async e=>{try{let[l,s]=await (0,a.Vx)(eq(e));if(l){b.error("删除声纹样本失败: ".concat(l.message));return}s&&s.success&&(o(d.map(l=>({...l,samples:l.samples.filter(l=>l.id!==e)}))),b.success("声纹样本已删除"))}catch(e){b.error("删除声纹样本时出错: ".concat(e.message))}},ej=(e,l)=>{G.default.confirm({title:"添加声纹样本",content:"确定要将文件 ".concat(l.name," 添加为声纹样本吗？"),onOk:async()=>{try{let s=new FormData;s.append("file",l);let[t,n]=await (0,a.Vx)(eM(e,s));if(t){b.error("添加声纹样本失败: ".concat(t.message));return}n&&(o(d.map(l=>l.id===e?{...l,samples:[...l.samples,n]}:l)),b.success("声纹样本已添加"))}catch(e){b.error("添加声纹样本时出错: ".concat(e.message))}}})},eg=async()=>{if(!H){b.error("请输入目录路径");return}try{let[e,l]=await (0,a.Vx)(eK(H));if(e){b.error("批量注册声纹失败: ".concat(e.message));return}l&&l.success&&(Y(),b.success("已成功注册 ".concat(Object.keys(l.registeredVoices||{}).length," 个声纹")),Q(!1))}catch(e){b.error("批量注册声纹时出错: ".concat(e.message))}},ev=e=>{if(g===e)k.current&&(k.current.pause(),k.current.currentTime=0),y(null),b.info("停止播放");else{let l=eH(e);if(!l){b.error("无法播放：样本URL未找到");return}k.current&&(k.current.src=l,k.current.onloadedmetadata=()=>{k.current&&k.current.play().then(()=>{y(e),b.info("正在播放声纹样本")}).catch(e=>{b.error("播放失败: ".concat(e.message))})},k.current.onended=()=>{y(null)})}},eZ=[{title:"样本名称",dataIndex:"name",key:"name",width:"40%"},{title:"时长",dataIndex:"duration",key:"duration",width:"15%",align:"center"},{title:"上传日期",dataIndex:"uploadDate",key:"uploadDate",width:"25%",align:"center"},{title:"操作",key:"action",width:"20%",align:"center",render:(e,l)=>(0,i.jsxs)(el.Z,{size:"small",children:[(0,i.jsx)(et.ZP,{type:"link",size:"small",icon:g===l.id?(0,i.jsx)(D.Z,{}):(0,i.jsx)(O.Z,{}),onClick:()=>ev(l.id),style:{padding:"4px 8px"},children:g===l.id?"停止":"播放"}),(0,i.jsx)(et.ZP,{type:"link",size:"small",danger:!0,icon:(0,i.jsx)(L.Z,{}),onClick:()=>ef(l.id),style:{padding:"4px 8px"},children:"删除"})]})}],eb=[{title:"用户",key:"user",width:"60%",render:(e,l)=>(0,i.jsxs)(el.Z,{align:"center",style:{width:"100%"},children:[(0,i.jsx)(eL.C,{icon:(0,i.jsx)(eR.Z,{})}),u===l.id?(0,i.jsx)(ed.default,{value:p,onChange:e=>m(e.target.value),onPressEnter:eh,style:{width:200}}):(0,i.jsxs)("div",{style:{flex:1},children:[(0,i.jsx)("div",{children:l.name}),(0,i.jsxs)(eG,{type:"secondary",style:{fontSize:12},children:[l.samples.length," 个声纹样本","unnamed"===l.type&&(0,i.jsx)($.Z,{color:"orange",style:{marginLeft:8},children:"自动注册"})]})]})]})},{title:"操作",key:"action",width:"40%",align:"center",render:(e,l)=>(0,i.jsxs)(el.Z,{size:"small",children:[u===l.id?(0,i.jsxs)(i.Fragment,{children:[(0,i.jsx)(et.ZP,{type:"link",size:"small",onClick:eh,children:"保存"}),(0,i.jsx)(et.ZP,{type:"link",size:"small",onClick:ep,children:"取消"})]}):(0,i.jsx)(et.ZP,{type:"link",size:"small",icon:(0,i.jsx)(B.Z,{}),onClick:()=>eu(l),children:"编辑"}),(0,i.jsx)(et.ZP,{type:"link",size:"small",danger:!0,onClick:()=>em(l.id),children:"删除"})]})}],eP={name:"audio",multiple:!1,accept:".mp3,.wav,.ogg,.m4a",showUploadList:!1,beforeUpload:(e,l)=>!1};return(0,i.jsxs)("div",{children:[w,(0,i.jsx)("div",{style:{marginBottom:16},children:(0,i.jsxs)(et.ZP.Group,{children:[(0,i.jsx)(et.ZP,{type:"1"===c?"primary":"default",ghost:"1"===c,onClick:()=>x("1"),children:"语音转换"}),(0,i.jsx)(et.ZP,{type:"2"===c?"primary":"default",ghost:"2"===c,onClick:()=>x("2"),children:"声纹管理"})]})}),"1"===c?(0,i.jsxs)(i.Fragment,{children:[(0,i.jsx)(ei.Z,{title:"识别配置",bordered:!0,style:{borderRadius:4,marginBottom:16,boxShadow:"none"},children:(0,i.jsxs)(ea.Z,{gutter:[16,16],children:[(0,i.jsx)(er.Z,{span:12,children:(0,i.jsxs)("div",{style:{marginBottom:16},children:[(0,i.jsx)(eG,{strong:!0,children:"识别语言："}),(0,i.jsx)(X.default,{value:P,onChange:e=>C(e),style:{width:"100%",marginTop:8},disabled:s,children:eJ.map(e=>(0,i.jsx)(eQ,{value:e.value,children:e.label},e.value))})]})}),(0,i.jsx)(er.Z,{span:12,children:(0,i.jsxs)("div",{style:{marginBottom:16},children:[(0,i.jsx)(eG,{strong:!0,children:"识别模型："}),(0,i.jsx)(X.default,{value:_,onChange:e=>S(e),style:{width:"100%",marginTop:8},disabled:s,children:eY.map(e=>(0,i.jsx)(eQ,{value:e.value,children:e.label},e.value))})]})}),(0,i.jsx)(er.Z,{span:12,children:(0,i.jsxs)("div",{style:{marginBottom:16},children:[(0,i.jsx)(eG,{strong:!0,children:"启用标点符号："}),(0,i.jsxs)("div",{style:{marginTop:8},children:[(0,i.jsx)(en.Z,{checked:z,onChange:e=>T(e),disabled:s}),(0,i.jsx)(eG,{style:{marginLeft:8},children:z?"开启":"关闭"})]})]})}),(0,i.jsx)(er.Z,{span:12,children:(0,i.jsxs)("div",{style:{marginBottom:16},children:[(0,i.jsx)(eG,{strong:!0,children:"启用说话人分离："}),(0,i.jsxs)("div",{style:{marginTop:8},children:[(0,i.jsx)(en.Z,{checked:F,onChange:e=>{R(e),e||N(!1)},disabled:s}),(0,i.jsx)(eG,{style:{marginLeft:8},children:F?"开启":"关闭"})]})]})}),(0,i.jsx)(er.Z,{span:12,children:(0,i.jsxs)("div",{style:{marginBottom:16},children:[(0,i.jsx)(eG,{strong:!0,children:"是否自动注册声纹："}),(0,i.jsxs)("div",{style:{marginTop:8},children:[(0,i.jsx)(en.Z,{checked:V,onChange:e=>N(e),disabled:s||!F}),(0,i.jsx)(eG,{style:{marginLeft:8},children:V?"开启（自动注册未知声音）":"关闭（仅识别已有声纹）"})]})]})}),(0,i.jsx)(er.Z,{span:12,children:(0,i.jsxs)("div",{style:{marginBottom:16},children:[(0,i.jsx)(eG,{strong:!0,children:"声纹匹配阈值："}),(0,i.jsxs)("div",{style:{display:"flex",alignItems:"center",marginTop:8},children:[(0,i.jsx)(eV.Z,{min:0,max:1,step:.01,value:U,onChange:e=>A(e),style:{flex:1},disabled:s}),(0,i.jsx)("div",{style:{width:60,marginLeft:16},children:(0,i.jsx)(ed.default,{value:U,onChange:e=>{let l=parseFloat(e.target.value);!isNaN(l)&&l>=0&&l<=1&&A(l)},disabled:s})})]}),(0,i.jsx)(eG,{type:"secondary",style:{fontSize:12},children:"值越高，匹配要求越严格（0-1之间）"})]})}),(0,i.jsx)(er.Z,{span:24,children:(0,i.jsxs)("div",{children:[(0,i.jsx)(eG,{strong:!0,children:"热词列表："}),(0,i.jsx)(ed.default.TextArea,{value:M,onChange:e=>q(e.target.value),placeholder:"请输入热词，多个热词用空格分隔",style:{marginTop:8},autoSize:{minRows:2,maxRows:4},disabled:s}),(0,i.jsx)(eG,{type:"secondary",style:{fontSize:12},children:"添加与录音内容相关的关键词可提高识别准确率"})]})})]})}),(0,i.jsxs)(ei.Z,{title:"上传音频文件",bordered:!0,style:{borderRadius:4,marginBottom:16,boxShadow:"none"},extra:e.length>0&&(0,i.jsx)(et.ZP,{icon:(0,i.jsx)(L.Z,{}),onClick:()=>{l([]),r([]),Z({}),b.success("已清除所有音频文件")},children:"清除全部"}),children:[(0,i.jsxs)(eW,{name:"audio",multiple:!0,accept:".mp3,.wav,.ogg,.m4a",beforeUpload:e=>(l(l=>[...l,e]),Z(l=>({...l,[e.uid]:0})),!1),onRemove:e=>{l(l=>l.filter(l=>l.uid!==e.uid)),r(l=>l.filter(l=>l.fileUid!==e.uid)),Z(l=>{let s={...l};return delete s[e.uid],s})},fileList:e,children:[(0,i.jsx)("p",{className:"ant-upload-drag-icon",children:(0,i.jsx)(E.Z,{})}),(0,i.jsx)("p",{className:"ant-upload-text",children:"点击或拖拽多个音频文件到此区域上传"}),(0,i.jsx)("p",{className:"ant-upload-hint",children:"支持 .mp3, .wav, .ogg, .m4a 格式的音频文件（可多选）"})]}),e.length>0&&(0,i.jsxs)("div",{style:{marginTop:16},children:[(0,i.jsxs)("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center"},children:[(0,i.jsxs)(eG,{strong:!0,children:["已选择 ",e.length," 个文件："]}),(0,i.jsx)(et.ZP,{type:"primary",onClick:ee,loading:s,icon:(0,i.jsx)(E.Z,{}),disabled:0===e.length,children:"开始转换全部"})]}),(0,i.jsx)(eN.Z,{style:{marginTop:8},size:"small",bordered:!0,dataSource:e,renderItem:e=>{let l=n.some(l=>l.fileUid===e.uid),t=v[e.uid]||0;return(0,i.jsxs)(eN.Z.Item,{actions:[s?(0,i.jsx)(ek.Z,{percent:t,size:"small",style:{width:80}}):l?(0,i.jsx)($.Z,{color:"green",children:"已转换"}):(0,i.jsx)($.Z,{children:"未处理"})],children:[(0,i.jsx)(eG,{children:e.name}),(0,i.jsxs)(eG,{type:"secondary",style:{marginLeft:8},children:["(",(e.size?e.size/1024:0).toFixed(2)," KB)"]})]})}})]})]}),s&&(0,i.jsx)(ei.Z,{bordered:!0,style:{borderRadius:4,marginBottom:16,boxShadow:"none"},children:(0,i.jsxs)("div",{style:{textAlign:"center",padding:24},children:[(0,i.jsx)(eB.Z,{style:{fontSize:32}}),(0,i.jsxs)("p",{style:{marginTop:16},children:["正在处理 ",e.length," 个音频文件，请稍候..."]}),(0,i.jsx)(ek.Z,{percent:75,status:"active"})]})}),n.length>0&&!s&&(0,i.jsxs)(ei.Z,{title:"转换结果",bordered:!0,style:{borderRadius:4,marginBottom:16,boxShadow:"none"},extra:(0,i.jsx)(et.ZP,{type:"primary",icon:(0,i.jsx)(I.Z,{}),onClick:()=>{if(0===n.length)return;let e=n.map(e=>"=== ".concat(e.fileName," ===\n").concat(e.text,"\n\n")).join(""),l=document.createElement("a"),s=new Blob([e],{type:"text/plain"});l.href=URL.createObjectURL(s),l.download="所有语音转换结果.txt",document.body.appendChild(l),l.click(),document.body.removeChild(l),b.success("所有转换结果已下载")},children:"下载全部结果"}),children:[(0,i.jsxs)("div",{style:{marginBottom:16},children:[(0,i.jsx)(ey.Z,{style:{color:"#52c41a",marginRight:8}}),(0,i.jsxs)(eG,{type:"success",children:["已成功转换 ",n.filter(e=>e.success).length," 个文件！"]}),n.some(e=>!e.success)&&(0,i.jsxs)(eG,{type:"danger",style:{marginLeft:16},children:[n.filter(e=>!e.success).length," 个文件处理失败"]})]}),n.map((e,l)=>(0,i.jsx)(ei.Z,{type:"inner",title:"文件名：".concat(e.fileName),style:{marginBottom:16},extra:e.success?(0,i.jsx)(et.ZP,{type:"link",icon:(0,i.jsx)(I.Z,{}),onClick:()=>es(e),children:"下载文本"}):null,children:e.success?(0,i.jsxs)(i.Fragment,{children:[(0,i.jsx)("div",{style:{background:"#f5f5f5",padding:16,borderRadius:4,whiteSpace:"pre-wrap"},children:e.text}),(0,i.jsxs)("div",{style:{marginTop:8},children:[(0,i.jsxs)(eG,{type:"secondary",children:["处理用时: ",e.processingTime," 秒"]}),e.duration&&(0,i.jsxs)(eG,{type:"secondary",style:{marginLeft:16},children:["音频时长: ",Math.floor(e.duration/60),":",Math.floor(e.duration%60).toString().padStart(2,"0")]}),e.autoRegisteredSpeakers&&e.autoRegisteredSpeakers>0&&(0,i.jsxs)($.Z,{color:"blue",style:{marginLeft:16},children:["自动注册了 ",e.autoRegisteredSpeakers," 个新声纹"]})]})]}):(0,i.jsx)("div",{style:{background:"#fff2f0",padding:16,borderRadius:4,border:"1px solid #ffccc7"},children:(0,i.jsxs)(eG,{type:"danger",children:["处理失败: ",e.error||"未知错误"]})})},l))]})]}):(0,i.jsxs)(ei.Z,{bordered:!0,style:{borderRadius:4,marginBottom:16,boxShadow:"none"},children:[(0,i.jsxs)("div",{style:{marginBottom:16,display:"flex",justifyContent:"space-between",alignItems:"center"},children:[(0,i.jsx)(eG,{children:"管理您的声纹样本，提高识别准确度"}),(0,i.jsxs)(el.Z,{children:[(0,i.jsx)(et.ZP,{onClick:()=>Q(!0),children:"批量注册声纹"}),(0,i.jsx)(et.ZP,{type:"primary",icon:(0,i.jsx)(eR.Z,{}),onClick:()=>{let e=document.createElement("input");e.type="file",e.accept=".mp3,.wav,.ogg,.m4a",e.style.display="none",e.onchange=async l=>{var s;let t=l.target,n=null===(s=t.files)||void 0===s?void 0:s[0];if(!n){b.warning("请选择音频文件");return}let a="",r=G.default.confirm({title:"添加新声纹",content:(0,i.jsxs)("div",{children:[(0,i.jsxs)("p",{style:{marginBottom:16},children:["已选择文件: ",n.name]}),(0,i.jsx)(ed.default,{placeholder:"请输入声纹名称",defaultValue:"用户".concat(d.length+1),onChange:e=>{a=e.target.value},onPressEnter:()=>{r.destroy(),ec(a||"用户".concat(d.length+1),n)}})]}),onOk:()=>ec(a||"用户".concat(d.length+1),n),onCancel:()=>{document.body.removeChild(e)}})},document.body.appendChild(e),e.click()},children:"添加新声纹"}),d.length>0&&(0,i.jsx)(et.ZP,{type:"default",danger:!0,icon:(0,i.jsx)(L.Z,{}),onClick:()=>{G.default.confirm({title:"清除所有声纹",content:"确定要删除所有声纹数据吗？此操作不可撤销。",onOk:async()=>{try{let[e,l]=await (0,a.Vx)(eX());if(e){b.error("清除声纹失败: ".concat(e.message));return}l&&l.success&&(o([]),b.success("所有声纹已清除"))}catch(e){b.error("清除声纹时出错: ".concat(e.message))}}})},children:"清除所有声纹"})]})]}),(0,i.jsx)(eo.Z,{dataSource:d,columns:eb,rowKey:"id",expandable:{expandedRowKeys:f,onExpand:(e,l)=>{e?j([...f,l.id]):j(f.filter(e=>e!==l.id))},expandedRowRender:e=>(0,i.jsxs)(i.Fragment,{children:[(0,i.jsxs)("div",{style:{padding:"16px 40px",backgroundColor:"#f5f5f5",display:"flex",justifyContent:"space-between",alignItems:"center"},children:[(0,i.jsx)(eG,{style:{fontSize:16,fontWeight:500},children:"声纹样本列表"}),(0,i.jsx)(ew.default,{...eP,onChange:l=>{"uploading"!==l.file.status&&ej(e.id,l.file)},children:(0,i.jsx)(et.ZP,{size:"small",icon:(0,i.jsx)(E.Z,{}),children:"添加样本"})})]}),(0,i.jsx)(eo.Z,{columns:eZ,dataSource:e.samples,rowKey:"id",size:"small",pagination:!1,style:{backgroundColor:"#fff"},tableLayout:"fixed"})]}),expandedRowClassName:()=>"voice-expanded-row",expandRowByClick:!1,expandIcon:e=>{let{expanded:l,onExpand:s,record:t}=e;return l?(0,i.jsx)("span",{onClick:e=>s(t,e),style:{cursor:"pointer",marginRight:8,fontSize:18,lineHeight:1},children:"−"}):(0,i.jsx)("span",{onClick:e=>s(t,e),style:{cursor:"pointer",marginRight:8,fontSize:18,lineHeight:1},children:"+"})},indentSize:0},pagination:!1,style:{width:"100%"},tableLayout:"fixed",locale:{emptyText:"暂无声纹数据，请添加新声纹"}})]}),(0,i.jsx)(G.default,{title:"批量注册声纹",open:W,onOk:eg,onCancel:()=>Q(!1),children:(0,i.jsxs)("div",{style:{marginBottom:16},children:[(0,i.jsx)(eG,{children:"输入包含音频文件的服务器目录路径："}),(0,i.jsx)(ed.default,{value:H,onChange:e=>K(e.target.value),placeholder:"/path/to/audio/files",style:{marginTop:8}}),(0,i.jsx)(eG,{type:"secondary",style:{fontSize:12,display:"block",marginTop:8},children:"目录中的每个子文件夹将作为一个声纹，文件夹名称将作为声纹名称"})]})}),(0,i.jsx)("audio",{ref:k,style:{display:"none"},onEnded:()=>y(null)})]})},e0=s(97175),e1=s(21612),e4=s(50136);let{Header:e6,Content:e2}=e1.default;var e8=()=>{let[e,l]=(0,ex.useState)("1");return(0,i.jsxs)(e1.default,{style:{minHeight:"100vh",background:"#f0f2f5"},children:[(0,i.jsx)(e6,{style:{display:"flex",alignItems:"center",background:"#e6f7ff",padding:"0",boxShadow:"0 1px 4px rgba(0,21,41,.08)"},children:(0,i.jsxs)(e4.Z,{mode:"horizontal",selectedKeys:[e],style:{flex:1,borderBottom:"none",background:"#e6f7ff"},onSelect:e=>{let{key:s}=e;return l(s)},children:[(0,i.jsx)(e4.Z.Item,{icon:(0,i.jsx)(e0.Z,{}),children:"Excel入库"},"1"),(0,i.jsx)(e4.Z.Item,{icon:(0,i.jsx)(E.Z,{}),children:"语音转文字"},"2"),(0,i.jsx)(e4.Z.Item,{icon:(0,i.jsx)(V.Z,{}),children:"自动化加工"},"3")]})}),(0,i.jsx)(e1.default,{children:(0,i.jsxs)(e2,{style:{padding:24,margin:0,background:"#f0f2f5",minHeight:"calc(100vh - 64px)",overflowY:"auto"},children:["1"===e&&(0,i.jsx)(eF,{}),"2"===e&&(0,i.jsx)(e$,{}),"3"===e&&(0,i.jsx)(eg,{})]})})]})}}},function(e){e.O(0,[2913,3791,5278,4330,7611,8791,5030,5418,3457,4567,2398,9859,3303,7124,1300,9773,2721,4393,1549,6649,9774,2888,179],function(){return e(e.s=32083)}),_N_E=e.O()}]);